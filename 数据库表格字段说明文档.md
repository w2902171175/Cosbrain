# 数据库表格字段说明文档

本文档详细描述了学生项目协作平台的数据库表结构，共包含 **24个数据表**。

## 目录

1. [核心用户和项目表](#1-核心用户和项目表)
2. [聊天和通讯相关表](#2-聊天和通讯相关表)
3. [论坛社区功能表](#3-论坛社区功能表)
4. [知识管理系统表](#4-知识管理系统表)
5. [个人内容管理表](#5-个人内容管理表)
6. [课程管理表](#6-课程管理表)
7. [系统配置表](#7-系统配置表)

---

## 1. 核心用户和项目表

### 1.1 students (学生/用户信息表)

存储平台用户的基本信息、技能、偏好等。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 用户唯一标识 |
| email | String | Unique, Index, Nullable | 用户邮箱 |
| password_hash | String | Nullable | 密码哈希值 |
| username | String | Unique, Index, Not Null, Default="新用户" | 用户名 |
| phone_number | String | Unique, Index, Nullable | 手机号码 |
| school | String | Nullable | 学校信息 |
| name | String | Index | 真实姓名 |
| major | String | Nullable | 专业 |
| skills | JSONB | Not Null, Default=[] | 技能列表（名称+熟练度） |
| interests | Text | Nullable | 兴趣爱好 |
| bio | Text | Default="欢迎使用本平台！" | 个人简介 |
| awards_competitions | Text | Nullable | 获奖竞赛经历 |
| academic_achievements | Text | Nullable | 学术成就 |
| soft_skills | Text | Nullable | 软技能 |
| portfolio_link | String | Nullable | 作品集链接 |
| preferred_role | String | Nullable | 偏好角色 |
| availability | String | Nullable | 可用时间 |
| location | String | Nullable | 学生所在地理位置 |
| combined_text | Text | Nullable | 合并文本（用于搜索） |
| embedding | Vector(1024) | Nullable | 向量嵌入（AI搜索） |
| llm_api_type | String | Nullable | LLM API类型 |
| llm_api_key_encrypted | Text | Nullable | 加密的LLM API密钥 |
| llm_api_base_url | String | Nullable | LLM API基础URL |
| llm_model_id | String | Nullable | LLM模型ID |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |
| is_admin | Boolean | Default=False, Not Null | 是否为管理员 |

### 1.2 projects (项目信息表)

存储项目的详细信息、需求、状态等。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 项目唯一标识 |
| title | String | Index | 项目标题 |
| description | Text | | 项目描述 |
| required_skills | JSONB | Not Null, Default=[] | 所需技能列表 |
| required_roles | JSONB | Not Null, Default=[] | 所需角色列表 |
| keywords | String | | 关键词 |
| project_type | String | | 项目类型 |
| expected_deliverables | Text | | 预期交付物 |
| contact_person_info | String | | 联系人信息 |
| learning_outcomes | Text | | 学习成果 |
| team_size_preference | String | | 团队规模偏好 |
| project_status | String | | 项目状态 |
| start_date | DateTime | Nullable | 项目开始日期 |
| end_date | DateTime | Nullable | 项目结束日期 |
| estimated_weekly_hours | Integer | Nullable | 项目估计每周所需投入小时数 |
| location | String | Nullable | 项目所在地理位置 |
| creator_id | Integer | Foreign Key(students.id), Not Null | 创建者ID |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入（AI匹配） |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

---

## 2. 聊天和通讯相关表

### 2.1 chat_rooms (聊天室表)

管理项目或课程的聊天室。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 聊天室唯一标识 |
| name | String | Not Null, Unique | 聊天室名称 |
| type | String | Not Null, Default="general" | 聊天室类型 |
| project_id | Integer | Foreign Key(projects.id), Unique, Nullable | 关联项目ID |
| course_id | Integer | Foreign Key(courses.id), Unique, Nullable | 关联课程ID |
| creator_id | Integer | Foreign Key(students.id), Not Null | 创建者（群主）ID |
| color | String | Nullable | 聊天室颜色 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 2.2 chat_messages (聊天消息表)

存储聊天室中的所有消息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 消息唯一标识 |
| room_id | Integer | Foreign Key(chat_rooms.id), Not Null | 所属聊天室ID |
| sender_id | Integer | Foreign Key(students.id), Not Null | 发送者ID |
| content_text | Text | Not Null | 消息内容 |
| message_type | String | Default="text" | 消息类型 |
| media_url | String | Nullable | 媒体文件URL |
| sent_at | DateTime | Server Default=now() | 发送时间 |

### 2.3 chat_room_members (聊天室成员表)

管理聊天室成员关系。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 成员关系唯一标识 |
| room_id | Integer | Foreign Key(chat_rooms.id), Not Null, Index | 聊天室ID |
| member_id | Integer | Foreign Key(students.id), Not Null, Index | 成员ID |
| role | String | Default="member", Not Null | 角色（admin/member） |
| status | String | Default="active", Not Null | 状态（active/banned/left） |
| joined_at | DateTime | Default=now(), Not Null | 加入时间 |

**约束**: UniqueConstraint(room_id, member_id) - 确保用户在聊天室中只有一条记录

### 2.4 chat_room_join_requests (聊天室加入请求表)

管理用户加入聊天室的申请。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 申请唯一标识 |
| room_id | Integer | Foreign Key(chat_rooms.id), Not Null, Index | 聊天室ID |
| requester_id | Integer | Foreign Key(students.id), Not Null, Index | 申请者ID |
| reason | String | Nullable | 申请理由 |
| status | String | Default="pending", Not Null | 状态（pending/approved/rejected） |
| requested_at | DateTime | Default=now(), Not Null | 申请时间 |
| processed_by_id | Integer | Foreign Key(students.id), Nullable | 处理者ID |
| processed_at | DateTime | Nullable | 处理时间 |

**约束**: Index(room_id, requester_id) - 确保用户在聊天室中最多只有一个pending申请

---

## 3. 论坛社区功能表

### 3.1 forum_topics (论坛主题表)

存储论坛中的主题帖子。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 主题唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 发布者ID |
| title | String | Not Null | 主题标题 |
| content | Text | Not Null | 主题内容 |
| shared_item_type | String | Nullable | 分享项目类型 |
| shared_item_id | Integer | Nullable | 分享项目ID |
| tags | String | Nullable | 标签 |
| likes_count | Integer | Default=0 | 点赞数 |
| comments_count | Integer | Default=0 | 评论数 |
| views_count | Integer | Default=0 | 浏览数 |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 3.2 forum_comments (论坛评论表)

存储论坛主题的评论（支持嵌套回复）。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 评论唯一标识 |
| topic_id | Integer | Foreign Key(forum_topics.id), Not Null | 所属主题ID |
| owner_id | Integer | Foreign Key(students.id), Not Null | 评论者ID |
| content | Text | Not Null | 评论内容 |
| parent_comment_id | Integer | Foreign Key(forum_comments.id), Nullable | 父评论ID（支持嵌套） |
| likes_count | Integer | Default=0 | 点赞数 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 3.3 forum_likes (论坛点赞表)

记录用户对主题或评论的点赞。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 点赞唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 点赞用户ID |
| topic_id | Integer | Foreign Key(forum_topics.id), Nullable | 点赞的主题ID |
| comment_id | Integer | Foreign Key(forum_comments.id), Nullable | 点赞的评论ID |
| created_at | DateTime | Server Default=now() | 点赞时间 |

### 3.4 user_follows (用户关注关系表)

管理用户之间的关注关系。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 关注关系唯一标识 |
| follower_id | Integer | Foreign Key(students.id), Not Null | 关注者ID |
| followed_id | Integer | Foreign Key(students.id), Not Null | 被关注者ID |
| created_at | DateTime | Server Default=now() | 关注时间 |

---

## 4. 知识管理系统表

### 4.1 knowledge_bases (知识库表)

管理个人或团队知识库。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 知识库唯一标识 |
| owner_id | Integer | Foreign Key(students.id) | 拥有者ID |
| name | String | Index, Not Null | 知识库名称 |
| description | Text | | 知识库描述 |
| access_type | String | | 访问类型（private/public/shared） |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 4.2 knowledge_articles (知识文章表)

存储知识库中的文章内容。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 文章唯一标识 |
| kb_id | Integer | Foreign Key(knowledge_bases.id) | 所属知识库ID |
| author_id | Integer | Foreign Key(students.id) | 作者ID |
| title | String | Index | 文章标题 |
| content | Text | | 文章内容 |
| version | String | | 版本号 |
| tags | String | | 标签 |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 4.3 knowledge_documents (上传文档表)

管理用户上传的文档文件。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 文档唯一标识 |
| kb_id | Integer | Foreign Key(knowledge_bases.id), Not Null | 所属知识库ID |
| owner_id | Integer | Foreign Key(students.id), Not Null | 上传者ID |
| file_name | String | Not Null | 文件名 |
| file_path | String | Not Null | 文件路径 |
| file_type | String | Nullable | 文件类型 |
| status | String | Default="processing" | 处理状态 |
| processing_message | Text | Nullable | 处理消息 |
| total_chunks | Integer | Default=0 | 总分块数 |
| created_at | DateTime | Server Default=now() | 上传时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 4.4 knowledge_document_chunks (文档分块表)

存储文档的分块内容，用于RAG检索。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 分块唯一标识 |
| document_id | Integer | Foreign Key(knowledge_documents.id), Not Null | 所属文档ID |
| owner_id | Integer | Foreign Key(students.id), Not Null | 所有者ID |
| kb_id | Integer | Foreign Key(knowledge_bases.id), Not Null | 所属知识库ID |
| chunk_index | Integer | Not Null | 分块索引 |
| content | Text | Not Null | 分块内容 |
| embedding | Vector(1024) | | 向量嵌入（用于相似度搜索） |
| created_at | DateTime | Server Default=now() | 创建时间 |

---

## 5. 个人内容管理表

### 5.1 notes (个人笔记表)

存储用户的个人笔记。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 笔记唯一标识 |
| owner_id | Integer | Foreign Key(students.id) | 笔记所有者ID |
| title | String | | 笔记标题 |
| content | Text | | 笔记内容 |
| note_type | String | | 笔记类型 |
| course_id | Integer | Foreign Key(courses.id), Nullable | 关联课程ID |
| tags | String | | 标签 |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 5.2 daily_records (日常记录表)

存储用户的日常学习记录。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 记录唯一标识 |
| owner_id | Integer | Foreign Key(students.id) | 记录所有者ID |
| content | Text | Not Null | 记录内容 |
| mood | String | Nullable | 心情状态 |
| tags | String | Nullable | 标签 |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 5.3 folders (文件夹表)

管理用户的文件夹结构（支持层级）。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 文件夹唯一标识 |
| owner_id | Integer | Foreign Key(students.id) | 文件夹所有者ID |
| name | String | Not Null | 文件夹名称 |
| description | Text | Nullable | 文件夹描述 |
| color | String | Nullable | 文件夹颜色 |
| icon | String | Nullable | 文件夹图标 |
| parent_id | Integer | Foreign Key(folders.id), Nullable, Index | 父文件夹ID |
| order | Integer | Default=0 | 排序顺序 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 5.4 collected_contents (收藏内容表)

存储用户收藏的各类内容。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 收藏内容唯一标识 |
| owner_id | Integer | Foreign Key(students.id) | 收藏者ID |
| folder_id | Integer | Foreign Key(folders.id), Nullable | 所属文件夹ID |
| title | String | Not Null | 内容标题 |
| type | String | Not Null | 内容类型 |
| url | String | Nullable | 内容URL |
| content | Text | Nullable | 内容正文 |
| tags | String | Nullable | 标签 |
| priority | Integer | Default=3 | 优先级 |
| notes | Text | Nullable | 备注 |
| access_count | Integer | Default=0 | 访问次数 |
| is_starred | Boolean | Default=False | 是否加星标 |
| thumbnail | String | Nullable | 缩略图 |
| author | String | Nullable | 作者 |
| duration | String | Nullable | 时长 |
| file_size | String | Nullable | 文件大小 |
| status | String | Default="active" | 状态 |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 5.5 collection_items (收藏项目表)

旧版收藏功能表（可能会被重构到collected_contents）。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 收藏项目唯一标识 |
| user_id | Integer | Foreign Key(students.id) | 用户ID |
| item_type | String | | 项目类型 |
| item_id | Integer | | 项目ID |
| created_at | DateTime | Server Default=now() | 收藏时间 |

---

## 6. 课程管理表

### 6.1 courses (课程表)

存储平台上的课程信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 课程唯一标识 |
| title | String | Index | 课程标题 |
| description | Text | | 课程描述 |
| instructor | String | | 讲师 |
| category | String | | 课程类别 |
| total_lessons | Integer | | 总课时 |
| avg_rating | Float | | 平均评分 |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 6.2 user_courses (用户课程关系表)

管理用户的课程学习进度。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| student_id | Integer | Primary Key, Foreign Key(students.id) | 学生ID |
| course_id | Integer | Primary Key, Foreign Key(courses.id) | 课程ID |
| progress | Float | Default=0.0 | 学习进度（0.0-1.0） |
| status | String | Default="in_progress" | 学习状态 |
| last_accessed | DateTime | Server Default=now(), On Update=now() | 最后访问时间 |
| created_at | DateTime | Server Default=now() | 开始学习时间 |

---

## 7. 系统配置表

### 7.1 user_mcp_configs (用户MCP配置表)

存储用户的MCP（Model Context Protocol）配置。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 配置唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 配置所有者ID |
| name | String | Not Null | 配置名称 |
| mcp_type | String | Nullable | MCP类型 |
| base_url | String | Not Null | 基础URL |
| protocol_type | String | Nullable | 协议类型 |
| api_key_encrypted | Text | Nullable | 加密的API密钥 |
| is_active | Boolean | Default=True | 是否启用 |
| description | Text | Nullable | 配置描述 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 7.2 user_search_engine_configs (搜索引擎配置表)

存储用户的搜索引擎配置。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 配置唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 配置所有者ID |
| name | String | Not Null | 配置名称 |
| engine_type | String | Not Null | 搜索引擎类型 |
| api_key_encrypted | Text | Nullable | 加密的API密钥 |
| is_active | Boolean | Default=True | 是否启用 |
| description | Text | Nullable | 配置描述 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 7.3 user_tts_configs (用户TTS语音配置表)

存储用户的文本转语音(TTS)配置信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 配置唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 配置所有者ID |
| name | String | Not Null | TTS配置名称，如：'我的OpenAI语音' |
| tts_type | String | Not Null | 语音提供商类型，如：'openai', 'gemini', 'aliyun' |
| api_key_encrypted | Text | Nullable | 加密后的API密钥 |
| base_url | String | Nullable | API基础URL |
| model_id | String | Nullable | 语音模型ID，如：'tts-1', 'gemini-pro' |
| voice_name | String | Nullable | 语音名称或ID，如：'alloy', 'f_cn_zh_anqi_a_f' |
| is_active | Boolean | Default=False, Not Null | 是否当前激活的TTS配置 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

**约束**: UniqueConstraint(owner_id, name) - 确保同一用户下配置名称唯一

---

## 数据库特性说明

### 向量搜索支持
本系统集成了pgvector扩展，支持向量嵌入和相似度搜索：
- 多个表包含`embedding`字段（Vector(1024)类型）
- 用于AI驱动的内容匹配和推荐
- 支持语义搜索和智能匹配

### 数据类型说明
- **Integer**: 整数类型
- **String**: 变长字符串
- **Text**: 长文本
- **DateTime**: 日期时间
- **Float**: 浮点数
- **Boolean**: 布尔值
- **JSONB**: PostgreSQL JSON二进制格式
- **Vector(1024)**: pgvector扩展的1024维向量类型

### 约束说明
- **Primary Key**: 主键
- **Foreign Key**: 外键
- **Unique**: 唯一约束
- **Index**: 索引
- **Not Null**: 非空约束
- **Default**: 默认值
- **Server Default**: 服务器端默认值

---

*最后更新时间: 2025-01-11*
*总表数: 24个*
