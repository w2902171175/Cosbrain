# 数据库表格字段说明文档

## 概述
本文档详细说明了系统中所有数据库表格的字段含义和用途。数据库使用PostgreSQL作为主要存储引擎，支持向量搜索功能。

---

## 1. 用户相关表格

### 1.1 students（学生/用户表）
用于存储系统用户的基本信息和配置。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 用户唯一标识符 |
| email | String | 唯一, 索引, 可空 | 用户邮箱地址 |
| password_hash | String | 可空 | 加密后的用户密码 |
| username | String | 唯一, 索引, 非空 | 用户名，默认"新用户" |
| phone_number | String | 唯一, 索引, 可空 | 用户手机号码 |
| school | String | 可空 | 用户所在学校 |
| name | String | 索引 | 用户真实姓名 |
| major | String | 可空 | 用户专业 |
| skills | Text | 可空 | 用户技能描述 |
| interests | Text | 可空 | 用户兴趣爱好 |
| bio | Text | 默认值 | 用户个人简介，默认"欢迎使用本平台！" |
| awards_competitions | Text | 可空 | 用户获奖和竞赛经历 |
| academic_achievements | Text | 可空 | 用户学术成就 |
| soft_skills | Text | 可空 | 用户软技能 |
| portfolio_link | String | 可空 | 用户作品集链接 |
| preferred_role | String | 可空 | 用户偏好角色 |
| availability | String | 可空 | 用户可用时间 |
| combined_text | Text | 可空 | 用户信息的组合文本（用于搜索） |
| embedding | Vector(1024) | 可空 | 用户信息的向量表示（用于相似度搜索） |
| llm_api_type | String | 可空 | 用户配置的LLM API类型 |
| llm_api_key_encrypted | Text | 可空 | 加密的LLM API密钥 |
| llm_api_base_url | String | 可空 | LLM API基础URL |
| llm_model_id | String | 可空 | LLM模型ID |
| created_at | DateTime | 服务器默认 | 账户创建时间 |
| updated_at | DateTime | 更新时自动 | 账户最后更新时间 |
| is_admin | Boolean | 默认False, 非空 | 是否为管理员 |

### 1.2 user_follows（用户关注表）
用于存储用户之间的关注关系。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 关注关系唯一标识符 |
| follower_id | Integer | 外键, 非空 | 关注者ID（指向students表） |
| followed_id | Integer | 外键, 非空 | 被关注者ID（指向students表） |
| created_at | DateTime | 服务器默认 | 关注时间 |

### 1.3 user_mcp_configs（用户MCP配置表）
用于存储用户的MCP（Model Context Protocol）配置。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 配置唯一标识符 |
| owner_id | Integer | 外键, 非空 | 配置所有者ID（指向students表） |
| name | String | 非空 | 配置名称 |
| mcp_type | String | 可空 | MCP类型 |
| base_url | String | 非空 | MCP服务基础URL |
| protocol_type | String | 可空 | 协议类型 |
| api_key_encrypted | Text | 可空 | 加密的API密钥 |
| is_active | Boolean | 默认True | 配置是否激活 |
| description | Text | 可空 | 配置描述 |
| created_at | DateTime | 服务器默认 | 配置创建时间 |
| updated_at | DateTime | 更新时自动 | 配置最后更新时间 |

### 1.4 user_search_engine_configs（用户搜索引擎配置表）
用于存储用户的搜索引擎配置。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 配置唯一标识符 |
| owner_id | Integer | 外键, 非空 | 配置所有者ID（指向students表） |
| name | String | 非空 | 配置名称 |
| engine_type | String | 非空 | 搜索引擎类型 |
| api_key_encrypted | Text | 可空 | 加密的API密钥 |
| is_active | Boolean | 默认True | 配置是否激活 |
| description | Text | 可空 | 配置描述 |
| created_at | DateTime | 服务器默认 | 配置创建时间 |
| updated_at | DateTime | 更新时自动 | 配置最后更新时间 |

---

## 2. 项目相关表格

### 2.1 projects（项目表）
用于存储项目信息。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 项目唯一标识符 |
| title | String | 索引 | 项目标题 |
| description | Text | - | 项目描述 |
| required_skills | Text | - | 项目所需技能 |
| keywords | String | - | 项目关键词 |
| project_type | String | - | 项目类型 |
| expected_deliverables | Text | - | 期望交付物 |
| contact_person_info | String | - | 联系人信息 |
| learning_outcomes | Text | - | 学习成果 |
| team_size_preference | String | - | 团队规模偏好 |
| project_status | String | - | 项目状态 |
| combined_text | Text | - | 项目信息的组合文本（用于搜索） |
| embedding | Vector(1024) | - | 项目信息的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 项目创建时间 |
| updated_at | DateTime | 更新时自动 | 项目最后更新时间 |

---

## 3. 聊天系统相关表格

### 3.1 chat_rooms（聊天室表）
用于存储聊天室信息。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 聊天室唯一标识符 |
| name | String | 非空, 唯一 | 聊天室名称 |
| type | String | 非空, 默认"general" | 聊天室类型 |
| project_id | Integer | 外键, 可空, 唯一 | 关联的项目ID（指向projects表） |
| course_id | Integer | 外键, 可空, 唯一 | 关联的课程ID（指向courses表） |
| creator_id | Integer | 外键, 非空 | 聊天室创建者ID（指向students表） |
| color | String | 可空 | 聊天室颜色 |
| created_at | DateTime | 服务器默认 | 聊天室创建时间 |
| updated_at | DateTime | 更新时自动 | 聊天室最后更新时间 |

### 3.2 chat_messages（聊天消息表）
用于存储聊天消息。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 消息唯一标识符 |
| room_id | Integer | 外键, 非空 | 所属聊天室ID（指向chat_rooms表） |
| sender_id | Integer | 外键, 非空 | 发送者ID（指向students表） |
| content_text | Text | 非空 | 消息文本内容 |
| message_type | String | 默认"text" | 消息类型 |
| media_url | String | 可空 | 媒体文件URL |
| sent_at | DateTime | 服务器默认 | 消息发送时间 |

### 3.3 chat_room_members（聊天室成员表）
用于存储聊天室成员关系。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 成员关系唯一标识符 |
| room_id | Integer | 外键, 非空, 索引 | 聊天室ID（指向chat_rooms表） |
| member_id | Integer | 外键, 非空, 索引 | 成员ID（指向students表） |
| role | String | 默认"member", 非空 | 成员角色（admin管理员/member普通成员） |
| status | String | 默认"active", 非空 | 成员状态（active活跃/banned被踢出/left已离开） |
| joined_at | DateTime | 默认当前时间, 非空 | 加入时间 |

**约束：** 唯一约束确保一个用户在一个聊天室中只有一条成员记录。

### 3.4 chat_room_join_requests（聊天室加入请求表）
用于存储聊天室加入申请。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 请求唯一标识符 |
| room_id | Integer | 外键, 非空, 索引 | 聊天室ID（指向chat_rooms表） |
| requester_id | Integer | 外键, 非空, 索引 | 申请者ID（指向students表） |
| reason | String | 可空 | 申请理由 |
| status | String | 默认"pending", 非空 | 请求状态（pending待处理/approved已批准/rejected已拒绝） |
| requested_at | DateTime | 默认当前时间, 非空 | 申请时间 |
| processed_by_id | Integer | 外键, 可空 | 处理者ID（指向students表） |
| processed_at | DateTime | 可空 | 处理时间 |

**约束：** 索引确保一个用户在一个聊天室中最多只有一个pending状态的申请。

---

## 4. 论坛系统相关表格

### 4.1 forum_topics（论坛话题表）
用于存储论坛话题。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 话题唯一标识符 |
| owner_id | Integer | 外键, 非空 | 话题创建者ID（指向students表） |
| title | String | 非空 | 话题标题 |
| content | Text | 非空 | 话题内容 |
| shared_item_type | String | 可空 | 分享物品类型 |
| shared_item_id | Integer | 可空 | 分享物品ID |
| tags | String | 可空 | 话题标签 |
| likes_count | Integer | 默认0 | 点赞数量 |
| comments_count | Integer | 默认0 | 评论数量 |
| views_count | Integer | 默认0 | 浏览数量 |
| combined_text | Text | - | 话题信息的组合文本（用于搜索） |
| embedding | Vector(1024) | - | 话题信息的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 话题创建时间 |
| updated_at | DateTime | 更新时自动 | 话题最后更新时间 |

### 4.2 forum_comments（论坛评论表）
用于存储论坛评论。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 评论唯一标识符 |
| topic_id | Integer | 外键, 非空 | 所属话题ID（指向forum_topics表） |
| owner_id | Integer | 外键, 非空 | 评论者ID（指向students表） |
| content | Text | 非空 | 评论内容 |
| parent_comment_id | Integer | 外键, 可空 | 父评论ID（指向forum_comments表，用于回复功能） |
| likes_count | Integer | 默认0 | 点赞数量 |
| created_at | DateTime | 服务器默认 | 评论创建时间 |
| updated_at | DateTime | 更新时自动 | 评论最后更新时间 |

### 4.3 forum_likes（论坛点赞表）
用于存储论坛点赞记录。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 点赞记录唯一标识符 |
| owner_id | Integer | 外键, 非空 | 点赞者ID（指向students表） |
| topic_id | Integer | 外键, 可空 | 被点赞的话题ID（指向forum_topics表） |
| comment_id | Integer | 外键, 可空 | 被点赞的评论ID（指向forum_comments表） |
| created_at | DateTime | 服务器默认 | 点赞时间 |

---

## 5. 知识管理相关表格

### 5.1 knowledge_bases（知识库表）
用于存储知识库信息。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 知识库唯一标识符 |
| owner_id | Integer | 外键 | 知识库所有者ID（指向students表） |
| name | String | 索引, 非空 | 知识库名称 |
| description | Text | - | 知识库描述 |
| access_type | String | - | 访问类型 |
| created_at | DateTime | 服务器默认 | 知识库创建时间 |
| updated_at | DateTime | 更新时自动 | 知识库最后更新时间 |

### 5.2 knowledge_articles（知识库文章表）
用于存储知识库文章。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 文章唯一标识符 |
| kb_id | Integer | 外键 | 所属知识库ID（指向knowledge_bases表） |
| author_id | Integer | 外键 | 文章作者ID（指向students表） |
| title | String | 索引 | 文章标题 |
| content | Text | - | 文章内容 |
| version | String | - | 文章版本 |
| tags | String | - | 文章标签 |
| combined_text | Text | - | 文章信息的组合文本（用于搜索） |
| embedding | Vector(1024) | - | 文章信息的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 文章创建时间 |
| updated_at | DateTime | 更新时自动 | 文章最后更新时间 |

### 5.3 knowledge_documents（知识库文档表）
用于存储上传的文档信息。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 文档唯一标识符 |
| kb_id | Integer | 外键, 非空 | 所属知识库ID（指向knowledge_bases表） |
| owner_id | Integer | 外键, 非空 | 文档所有者ID（指向students表） |
| file_name | String | 非空 | 文件名 |
| file_path | String | 非空 | 文件路径 |
| file_type | String | 可空 | 文件类型 |
| status | String | 默认"processing" | 处理状态 |
| processing_message | Text | 可空 | 处理消息 |
| total_chunks | Integer | 默认0 | 总分块数量 |
| created_at | DateTime | 服务器默认 | 文档创建时间 |
| updated_at | DateTime | 更新时自动 | 文档最后更新时间 |

### 5.4 knowledge_document_chunks（知识库文档分块表）
用于存储文档分块信息，支持RAG（检索增强生成）功能。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 分块唯一标识符 |
| document_id | Integer | 外键, 非空 | 所属文档ID（指向knowledge_documents表） |
| owner_id | Integer | 外键, 非空 | 所有者ID（指向students表） |
| kb_id | Integer | 外键, 非空 | 所属知识库ID（指向knowledge_bases表） |
| chunk_index | Integer | 非空 | 分块索引 |
| content | Text | 非空 | 分块内容 |
| embedding | Vector(1024) | - | 分块内容的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 分块创建时间 |

---

## 6. 学习系统相关表格

### 6.1 courses（课程表）
用于存储课程信息。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 课程唯一标识符 |
| title | String | 索引 | 课程标题 |
| description | Text | - | 课程描述 |
| instructor | String | - | 讲师姓名 |
| category | String | - | 课程分类 |
| total_lessons | Integer | - | 总课时数 |
| avg_rating | Float | - | 平均评分 |
| combined_text | Text | - | 课程信息的组合文本（用于搜索） |
| embedding | Vector(1024) | - | 课程信息的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 课程创建时间 |
| updated_at | DateTime | 更新时自动 | 课程最后更新时间 |

### 6.2 user_courses（用户课程关系表）
用于存储用户与课程的关系。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| student_id | Integer | 外键, 主键 | 学生ID（指向students表） |
| course_id | Integer | 外键, 主键 | 课程ID（指向courses表） |
| progress | Float | 默认0.0 | 学习进度（0.0-1.0） |
| status | String | 默认"in_progress" | 学习状态 |
| last_accessed | DateTime | 服务器默认, 更新时自动 | 最后访问时间 |
| created_at | DateTime | 服务器默认 | 关系创建时间 |

---

## 7. 笔记和记录相关表格

### 7.1 notes（笔记表）
用于存储用户笔记。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 笔记唯一标识符 |
| owner_id | Integer | 外键 | 笔记所有者ID（指向students表） |
| title | String | - | 笔记标题 |
| content | Text | - | 笔记内容 |
| note_type | String | - | 笔记类型 |
| course_id | Integer | 外键, 可空 | 关联课程ID（指向courses表） |
| tags | String | - | 笔记标签 |
| combined_text | Text | - | 笔记信息的组合文本（用于搜索） |
| embedding | Vector(1024) | - | 笔记信息的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 笔记创建时间 |
| updated_at | DateTime | 更新时自动 | 笔记最后更新时间 |

### 7.2 daily_records（日常记录表）
用于存储用户的日常记录。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 记录唯一标识符 |
| owner_id | Integer | 外键 | 记录所有者ID（指向students表） |
| content | Text | 非空 | 记录内容 |
| mood | String | 可空 | 心情状态 |
| tags | String | 可空 | 记录标签 |
| combined_text | Text | - | 记录信息的组合文本（用于搜索） |
| embedding | Vector(1024) | - | 记录信息的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 记录创建时间 |
| updated_at | DateTime | 更新时自动 | 记录最后更新时间 |

---

## 8. 收藏和组织相关表格

### 8.1 folders（文件夹表）
用于存储用户的文件夹结构。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 文件夹唯一标识符 |
| owner_id | Integer | 外键 | 文件夹所有者ID（指向students表） |
| name | String | 非空 | 文件夹名称 |
| description | Text | 可空 | 文件夹描述 |
| color | String | 可空 | 文件夹颜色 |
| icon | String | 可空 | 文件夹图标 |
| parent_id | Integer | 外键, 可空, 索引 | 父文件夹ID（指向folders表，支持层级结构） |
| order | Integer | 默认0 | 排序顺序 |
| created_at | DateTime | 服务器默认 | 文件夹创建时间 |
| updated_at | DateTime | 更新时自动 | 文件夹最后更新时间 |

### 8.2 collected_contents（收藏内容表）
用于存储用户收藏的各种内容。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 收藏内容唯一标识符 |
| owner_id | Integer | 外键 | 收藏者ID（指向students表） |
| folder_id | Integer | 外键, 可空 | 所属文件夹ID（指向folders表） |
| title | String | 非空 | 内容标题 |
| type | String | 非空 | 内容类型 |
| url | String | 可空 | 内容URL |
| content | Text | 可空 | 内容文本 |
| tags | String | 可空 | 内容标签 |
| priority | Integer | 默认3 | 优先级 |
| notes | Text | 可空 | 用户备注 |
| access_count | Integer | 默认0 | 访问次数 |
| is_starred | Boolean | 默认False | 是否标星 |
| thumbnail | String | 可空 | 缩略图URL |
| author | String | 可空 | 内容作者 |
| duration | String | 可空 | 内容时长 |
| file_size | String | 可空 | 文件大小 |
| status | String | 默认"active" | 内容状态 |
| combined_text | Text | - | 内容信息的组合文本（用于搜索） |
| embedding | Vector(1024) | - | 内容信息的向量表示（用于相似度搜索） |
| created_at | DateTime | 服务器默认 | 收藏时间 |
| updated_at | DateTime | 更新时自动 | 最后更新时间 |

### 8.3 collection_items（收藏项表）
旧版收藏功能表，可能在未来被重构或删除。

| 字段名 | 数据类型 | 约束 | 字段含义 |
|--------|----------|------|----------|
| id | Integer | 主键, 索引 | 收藏项唯一标识符 |
| user_id | Integer | 外键 | 用户ID（指向students表） |
| item_type | String | - | 收藏项类型 |
| item_id | Integer | - | 收藏项ID |
| created_at | DateTime | 服务器默认 | 收藏时间 |

---

## 9. 技术特性说明

### 9.1 向量搜索支持
系统使用pgvector扩展支持向量搜索功能，多个表格包含embedding字段（Vector(1024)），用于：
- 语义相似度搜索
- 内容推荐
- RAG（检索增强生成）功能

### 9.2 全文搜索支持
多个表格包含combined_text字段，将相关信息组合成文本，用于：
- 全文搜索
- 关键词匹配
- 内容索引

### 9.3 时间戳管理
大部分表格包含created_at和updated_at字段，提供：
- 数据创建时间追踪
- 数据修改历史
- 自动时间戳管理

### 9.4 关系完整性
数据库使用外键约束确保数据完整性，并通过relationship定义了丰富的关联关系，支持：
- 级联删除
- 关联查询
- 数据一致性

---

## 10. 使用建议

1. **性能优化**：对于大量数据的表格，建议在常用查询字段上创建适当的索引。
2. **数据备份**：定期备份包含用户重要数据的表格，如students、notes、collected_contents等。
3. **安全考虑**：敏感信息（如API密钥、密码）已使用加密存储，注意保护加密密钥。
4. **扩展性**：表格设计支持灵活扩展，可根据业务需求添加新字段或表格。

---

*本文档最后更新时间：2025年8月9日*
