# 数据库表格字段说明文档

本文档详细描述了学生项目协作平台的数据库表���构，共包含 **29个数据表**。

## 目录

1. [核心用户和项目表](#1-核心用户和项目表)
2. [聊天和通讯相关表](#2-聊天和通讯相关表)
3. [论坛社区功能表](#3-论坛社区功能表)
4. [知识管理系统表](#4-知识管理系统表)
5. [个人内容管理表](#5-个人内容管理表)
6. [课程管理表](#6-课程管理表)
7. [积分系统和成就系统表](#7-积分系统和成就系统表)
8. [系统配置表](#8-系统配置表)

---

## 1. 核心用户和项目表

### 1.1 students (学生/用户信息表)

存储平台用户的基本信息、技能、偏好、积分等。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, INDEX | 用户唯一标识符 |
| email | String | UNIQUE, INDEX, NULLABLE | 用户邮箱地址 |
| password_hash | String | NULLABLE | 加密后的密码 |
| username | String | UNIQUE, INDEX, NOT NULL | 用户名，默认"新用户" |
| phone_number | String | UNIQUE, INDEX, NULLABLE | 手机号码 |
| school | String | NULLABLE | 所在学校 |
| name | String | INDEX | 真实姓名 |
| major | String | NULLABLE | 专业 |
| skills | JSONB | NOT NULL, DEFAULT '[]' | 技能列表，包含名称和熟练度 |
| interests | Text | NULLABLE | 兴趣爱好 |
| bio | Text | DEFAULT "欢迎使用本平台！" | 个人简介 |
| awards_competitions | Text | NULLABLE | 获奖和竞赛经历 |
| academic_achievements | Text | NULLABLE | 学术成就 |
| soft_skills | Text | NULLABLE | 软技能 |
| portfolio_link | String | NULLABLE | 作品集链接 |
| preferred_role | String | NULLABLE | 偏好角色 |
| availability | String | NULLABLE | 可用时间 |
| location | String | NULLABLE | 地理位置 |
| combined_text | Text | NULLABLE | 组合文本（用于搜索） |
| embedding | Vector(1024) | NULLABLE | 向量嵌入 |
| llm_api_type | String | NULLABLE | LLM API类型 |
| llm_api_key_encrypted | Text | NULLABLE | 加密的LLM API密钥 |
| llm_api_base_url | String | NULLABLE | LLM API基础URL |
| llm_model_id | String | NULLABLE | LLM模型ID |
| total_points | Integer | NOT NULL, DEFAULT 0 | 用户当前总积分 |
| last_login_at | DateTime | NULLABLE | 上次登录时间 |
| login_count | Integer | NOT NULL, DEFAULT 0 | 总登录天数 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
| is_admin | Boolean | NOT NULL, DEFAULT FALSE | 是否为管理员 |
存储项目的基本信息、需求、状态等。
| id | Integer | PRIMARY KEY, INDEX | 项目唯一标识符 |
| title | String | INDEX | 项目标题 |
| description | Text |  | 项目描述 |
| required_skills | JSONB | NOT NULL, DEFAULT '[]' | 所需技能列表 |
| required_roles | JSONB | NOT NULL, DEFAULT '[]' | 所需角色列表 |
| keywords | String |  | 关键词 |
| project_type | String |  | 项目类型 |
| expected_deliverables | Text |  | 预期交��物 |
| contact_person_info | String |  | 联系人信息 |
| learning_outcomes | Text |  | 学习成果 |
| team_size_preference | String |  | 团队规模偏好 |
| project_status | String |  | 项目状态 |
| start_date | DateTime | NULLABLE | 项目开始日期 |
| end_date | DateTime | NULLABLE | 项目结束日期 |
| estimated_weekly_hours | Integer | NULLABLE | 估计每周投入小时数 |
| location | String | NULLABLE | 项目所在地理位置 |
| creator_id | Integer | FOREIGN KEY(students.id), NOT NULL | 项目创建者ID |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
存储聊天室信息。
| 字段名 | ��型 | 约束 | 说明 |
| id | Integer | PRIMARY KEY, INDEX | 聊天室唯一标识符 |
| name | String | NOT NULL, UNIQUE | 聊天室名称 |
| type | String | NOT NULL, DEFAULT "general" | 聊天室类型 |
| project_id | Integer | FOREIGN KEY(projects.id), NULLABLE, UNIQUE | 关联项目ID |
| course_id | Integer | FOREIGN KEY(courses.id), NULLABLE, UNIQUE | 关联课程ID |
| creator_id | Integer | FOREIGN KEY(students.id), NOT NULL | 群主ID |
| color | String | NULLABLE | 聊天室颜色 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
存储聊天消息内容。
| id | Integer | PRIMARY KEY, INDEX | 消息唯一标识符 |
| room_id | Integer | FOREIGN KEY(chat_rooms.id), NOT NULL | 所属聊天室ID |
| sender_id | Integer | FOREIGN KEY(students.id), NOT NULL | 发送者ID |
| content_text | Text | NOT NULL | 消息文本内容 |
| message_type | String | DEFAULT "text" | 消息类型 |
| media_url | String | NULLABLE | 媒体文件URL |
| sent_at | DateTime | DEFAULT now() | 发送时间 |
存储聊天室成员信息。
| id | Integer | PRIMARY KEY, INDEX | 成员记录唯一标识符 |
| room_id | Integer | FOREIGN KEY(chat_rooms.id), NOT NULL, INDEX | 聊天室ID |
| member_id | Integer | FOREIGN KEY(students.id), NOT NULL, INDEX | 成员ID |
| role | String | NOT NULL, DEFAULT "member" | 角色类型（admin/member） |
| status | String | NOT NULL, DEFAULT "active" | 成员状态（active/banned/left） |
| joined_at | DateTime | NOT NULL, DEFAULT now() | 加入时间 |
### 2.4 chat_room_join_requests (聊天室加入申请表)
存储聊天室加入申请信息。
| id | Integer | PRIMARY KEY, INDEX | 申请记录唯一标识符 |
| room_id | Integer | FOREIGN KEY(chat_rooms.id), NOT NULL, INDEX | 聊天室ID |
| requester_id | Integer | FOREIGN KEY(students.id), NOT NULL, INDEX | 申请者ID |
| reason | String | NULLABLE | 申请理由 |
| status | String | NOT NULL, DEFAULT "pending" | 申请状态（pending/approved/rejected） |
| requested_at | DateTime | NOT NULL, DEFAULT now() | 申请时间 |
| processed_by_id | Integer | FOREIGN KEY(students.id), NULLABLE | 处理者ID |
| processed_at | DateTime | NULLABLE | 处理时间 |
### 3.1 forum_topics (论坛话题表)
存储论坛话题信息。
| id | Integer | PRIMARY KEY, INDEX | 话题唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 话题创建者ID |
| title | String | NOT NULL | 话题标题 |
| content | Text | NOT NULL | 话题内容 |
| shared_item_type | String | NULLABLE | 分享内容类型 |
| shared_item_id | Integer | NULLABLE | 分享内容ID |
| tags | String | NULLABLE | 标签 |
| likes_count | Integer | DEFAULT 0 | 点赞数 |
| comments_count | Integer | DEFAULT 0 | 评论数 |
| views_count | Integer | DEFAULT 0 | 浏览数 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
存储论坛评论信息。
| id | Integer | PRIMARY KEY, INDEX | 评论唯一标识符 |
| topic_id | Integer | FOREIGN KEY(forum_topics.id), NOT NULL | 所属话题ID |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 评论者ID |
| content | Text | NOT NULL | 评论内容 |
| parent_comment_id | Integer | FOREIGN KEY(forum_comments.id), NULLABLE | 父评论ID（回复功能��� |
| likes_count | Integer | DEFAULT 0 | 点赞数 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
存储论坛点赞信息。
| id | Integer | PRIMARY KEY, INDEX | 点赞记录唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 点赞者ID |
| topic_id | Integer | FOREIGN KEY(forum_topics.id), NULLABLE | 话题ID |
| comment_id | Integer | FOREIGN KEY(forum_comments.id), NULLABLE | 评论ID |
| created_at | DateTime | DEFAULT now() | 点赞时间 |
### 3.4 user_follows (用户关注表)
存储用户之间的关注关系。
| id | Integer | PRIMARY KEY, INDEX | 关注记录唯一标识符 |
| follower_id | Integer | FOREIGN KEY(students.id), NOT NULL | 关注者ID |
| followed_id | Integer | FOREIGN KEY(students.id), NOT NULL | 被关注者ID |
| created_at | DateTime | DEFAULT now() | 关注时间 |
存储知识库信息。
| id | Integer | PRIMARY KEY, INDEX | 知识库唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 知识库拥有者ID |
| name | String | NOT NULL | 知识库名称 |
| description | Text | NULLABLE | 知识库描述 |
| is_public | Boolean | NOT NULL, DEFAULT FALSE | 是否公开 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
存储知识文章信息。
| id | Integer | PRIMARY KEY, INDEX | 文章唯一标识符 |
| knowledge_base_id | Integer | FOREIGN KEY(knowledge_bases.id), NOT NULL | 所属知识库ID |
| author_id | Integer | FOREIGN KEY(students.id), NOT NULL | 作者ID |
| title | String | NOT NULL | 文章标题 |
| content | Text | NOT NULL | 文章内容 |
| tags | String | NULLABLE | 标签 |
| is_published | Boolean | NOT NULL, DEFAULT FALSE | 是否已发布 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
### 4.3 knowledge_documents (知识文档表)
存储上传的文档信息。
| id | Integer | PRIMARY KEY, INDEX | 文档唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 文档拥有者ID |
| knowledge_base_id | Integer | FOREIGN KEY(knowledge_bases.id), NULLABLE | 所属知识���ID |
| filename | String | NOT NULL | 文件名 |
| original_filename | String | NOT NULL | 原始文件名 |
| file_type | String | NOT NULL | 文件类型 |
| file_size | Integer | NOT NULL | 文件大小 |
| file_path | String | NOT NULL | 文件路径 |
| extracted_text | Text | NULLABLE | 提取的文本内容 |
| processing_status | String | NOT NULL, DEFAULT "pending" | 处理状态 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| uploaded_at | DateTime | DEFAULT now() | 上传时间 |
| processed_at | DateTime | NULLABLE | 处理时间 |
### 5.1 notes (笔记表)
存储用户笔记信息。
| id | Integer | PRIMARY KEY, INDEX | 笔记唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id) | 笔记拥有者ID |
| title | String |  | 笔记标题 |
| content | Text |  | 笔记内容 |
| note_type | String |  | 笔记类型 |
| course_id | Integer | FOREIGN KEY(courses.id), NULLABLE | 关联课程ID |
| tags | String |  | 标签 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
### 5.2 daily_records (日记表)
存储用户日记信息。
| id | Integer | PRIMARY KEY, INDEX | 日记唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id) | 日记拥有者ID |
| content | Text | NOT NULL | 日记内容 |
| mood | String | NULLABLE | 心情 |
| tags | String | NULLABLE | 标签 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
存储用户文件夹信息。
| id | Integer | PRIMARY KEY, INDEX | 文件夹唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id) | 文件夹拥有者ID |
| name | String | NOT NULL | 文件夹名称 |
| description | Text | NULLABLE | 文件夹描述 |
| color | String | NULLABLE | 文件夹颜色 |
| icon | String | NULLABLE | 文件夹图标 |
| parent_id | Integer | FOREIGN KEY(folders.id), NULLABLE, INDEX | 父文件夹ID |
| order | Integer | DEFAULT 0 | 排序顺序 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
存储用户收藏的内容。
| id | Integer | PRIMARY KEY, INDEX | 收藏记录唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id) | 收藏者ID |
| folder_id | Integer | FOREIGN KEY(folders.id), NULLABLE | 所属文件夹ID |
| title | String | NOT NULL | 内容标题 |
| type | String | NOT NULL | 内容类型 |
| url | String | NULLABLE | 内容URL |
| content | Text | NULLABLE | 内容文本 |
| tags | String | NULLABLE | 标签 |
| priority | Integer | DEFAULT 3 | 优先级 |
| notes | Text | NULLABLE | 备注 |
| access_count | Integer | DEFAULT 0 | 访问次数 |
| is_starred | Boolean | DEFAULT FALSE | 是否标星 |
| thumbnail | String | NULLABLE | 缩略图 |
| author | String | NULLABLE | 作者 |
| duration | String | NULLABLE | 时长 |
| file_size | String | NULLABLE | 文件大小 |
| status | String | DEFAULT "active" | 状态 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |

---
## 6. 课程管理表
### 6.1 courses (课程表)

存储课程信息。
| id | Integer | PRIMARY KEY, INDEX | 课程唯一标识符 |
| course_code | String | UNIQUE, NOT NULL | 课程代码 |
| name | String | NOT NULL | 课程名称 |
| description | Text | NULLABLE | 课程描述 |
| instructor | String | NULLABLE | 授课教师 |
| semester | String | NULLABLE | 学期 |
| credits | Integer | NULLABLE | 学分 |
| schedule | String | NULLABLE | 课程安排 |
| location | String | NULLABLE | 上课地点 |
| max_students | Integer | NULLABLE | 最大学生数 |
| is_active | Boolean | NOT NULL, DEFAULT TRUE | 是否激活 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
### 6.2 course_materials (课程资料表)
存储课程资料信息。
| id | Integer | PRIMARY KEY, INDEX | 资料唯一标识符 |
| course_id | Integer | FOREIGN KEY(courses.id), NOT NULL | 所属课程ID |
| title | String | NOT NULL | 资料标题 |
| description | Text | NULLABLE | 资料描述 |
| material_type | String | NOT NULL | 资料类型 |
| file_path | String | NULLABLE | 文件路径 |
| url | String | NULLABLE | 资料URL |
| is_public | Boolean | NOT NULL, DEFAULT FALSE | 是否公开 |
| order | Integer | DEFAULT 0 | 排序顺序 |
| combined_text | Text |  | 组合文本（用于搜索） |
| embedding | Vector(1024) |  | 向量嵌入 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
### 6.3 user_courses (用户课程关联表)
存储用户与课程的关联关系。
| id | Integer | PRIMARY KEY, INDEX | 关联记录唯一标识符 |
| student_id | Integer | FOREIGN KEY(students.id), NOT NULL | 学生ID |
| course_id | Integer | FOREIGN KEY(courses.id), NOT NULL | 课程ID |
| role | String | NOT NULL, DEFAULT "student" | 角色（student/teacher/assistant） |
| enrollment_status | String | NOT NULL, DEFAULT "enrolled" | 注册状态 |
| grade | String | NULLABLE | 成绩 |
| enrolled_at | DateTime | DEFAULT now() | 注册时间 |
| completed_at | DateTime | NULLABLE | 完成时间 |
存储系统成就信息。
| id | Integer | PRIMARY KEY, INDEX | 成就唯一标识符 |
| name | String | NOT NULL, UNIQUE | 成就名称 |
| description | Text | NOT NULL | 成就描述 |
| icon | String | NULLABLE | 成就图标 |
| category | String | NOT NULL | 成就类别 |
| points_reward | Integer | NOT NULL, DEFAULT 0 | 奖励积分 |
| condition_type | String | NOT NULL | 条件类型 |
| condition_value | String | NOT NULL | 条件值 |
| is_active | Boolean | NOT NULL, DEFAULT TRUE | 是否激活 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
存储用户获得的成就。
| id | Integer | PRIMARY KEY, INDEX | 用户成就记录唯一标识符 |
| user_id | Integer | FOREIGN KEY(students.id), NOT NULL | 用户ID |
| achievement_id | Integer | FOREIGN KEY(achievements.id), NOT NULL | 成就ID |
| earned_at | DateTime | DEFAULT now() | 获得时间 |
| progress | Integer | DEFAULT 0 | 进度 |
### 7.3 point_transactions (积分交易表)
存储积分变动记录。
| id | Integer | PRIMARY KEY, INDEX | 交易记录唯一标识符 |
| user_id | Integer | FOREIGN KEY(students.id), NOT NULL | 用户ID |
| points | Integer | NOT NULL | 积分变动量（正数为获得，负数为消耗） |
| transaction_type | String | NOT NULL | 交易类型 |
| description | String | NULLABLE | 描述 |
| reference_type | String | NULLABLE | 引用类型 |
| reference_id | Integer | NULLABLE | 引用ID |
| created_at | DateTime | DEFAULT now() | 创建时间 |

### 7.4 collection_items (收藏物品表)

存储用户收藏的���品信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, INDEX | 收藏物品唯一标识符 |
| user_id | Integer | FOREIGN KEY(students.id), NOT NULL | 用户ID |
| item_type | String | NOT NULL | 物品类型 |
| item_id | Integer | NOT NULL | 物品ID |
| collected_at | DateTime | DEFAULT now() | 收藏时间 |
存储用户的MCP（模型控制协议）配置。
| id | Integer | PRIMARY KEY, INDEX | 配置唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 配置拥有者ID |
| name | String | NOT NULL | 配置名称 |
| mcp_type | String | NULLABLE | MCP类型 |
| base_url | String | NOT NULL | 基础URL |
| protocol_type | String | NULLABLE | 协议类型 |
| api_key_encrypted | Text | NULLABLE | 加密的API密钥 |
| is_active | Boolean | DEFAULT TRUE | 是否激活 |
| description | Text | NULLABLE | 描述 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
### 8.2 user_search_engine_configs (用户搜索引擎配置表)
| id | Integer | PRIMARY KEY, INDEX | 配置唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 配置拥有者ID |
| name | String | NOT NULL | 配置名称 |
| engine_type | String | NOT NULL | 搜索引擎类型 |
| api_key_encrypted | Text | NULLABLE | 加密的API密钥 |
| is_active | Boolean | DEFAULT TRUE | 是否激活 |
| description | Text | NULLABLE | 描述 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
### 8.3 user_tts_configs (用户TTS配置表)
存储用户的文本转语音配置。
| id | Integer | PRIMARY KEY, INDEX | 配置唯一标识符 |
| owner_id | Integer | FOREIGN KEY(students.id), NOT NULL | 配置拥有者ID |
| name | String | NOT NULL | TTS配置名称 |
| tts_type | String | NOT NULL | 语音提供商类型 |
| api_key_encrypted | Text | NULLABLE | 加密后的API密钥 |
| base_url | String | NULLABLE | API基础URL |
| model_id | String | NULLABLE | 语音模型ID |
| voice_name | String | NULLABLE | 语音名称或ID |
| is_active | Boolean | NOT NULL, DEFAULT FALSE | 是否当前激活的TTS配置 |
| created_at | DateTime | DEFAULT now() | 创建时间 |
| updated_at | DateTime | ON UPDATE now() | 更新时间 |
### 主要外键关系：
1. **用户相关**：
   - `daily_records.owner_id` → `students.id`
   - `folders.owner_id` → `students.id`
   - `collected_contents.owner_id` → `students.id`

2. **聊天系统**：
   - `chat_rooms.project_id` → `projects.id`
   - `chat_rooms.course_id` → `courses.id`

3. **论坛系统**：
   - `forum_topics.owner_id` → `students.id`
   - `forum_comments.topic_id` → `forum_topics.id`
   - `forum_comments.owner_id` → `students.id`
   - `forum_likes.owner_id` → `students.id`
4. **知识管理**：
   - `knowledge_bases.owner_id` → `students.id`
   - `knowledge_articles.knowledge_base_id` → `knowledge_bases.id`
   - `knowledge_articles.author_id` → `students.id`
5. **课程系统**：
   - `user_courses.student_id` → `students.id`
   - `user_courses.course_id` → `courses.id`
   - `course_materials.course_id` → `courses.id`

6. **积分成就**：
### 特殊约束：
1. **唯一性约束**：
   - `students.email`, `students.username`, `students.phone_number` 必须唯一
   - `chat_rooms.name` 必须唯一
   - `courses.course_code` 必须唯一
   - `achievements.name` 必须唯一
2. **复合唯一约束**：
   - `chat_room_members(room_id, member_id)` 确保用户在聊天室中只有一条成员记录
   - `user_tts_configs(owner_id, name)` 确保用户TTS配��名称唯一
3. **向量索引**：
   - 多个表包含 `embedding` 字段，用于向量相似度搜索
   - `combined_text` 字段用于全文搜索
此文档基于实际的数据库模型定义，准确反映了当前系统的数据库结构。
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 课程唯一标识 |
| title | String | Index | 课程标题 |
| description | Text | | 课程描述 |
| instructor | String | | 讲师 |
| category | String | | 课程类别 |
| total_lessons | Integer | | 总课时 |
| avg_rating | Float | | 平均评分 |
| cover_image_url | String | Nullable | 课程封面图片URL |
| required_skills | JSONB | Not Null, Default=[] | 学习该课程所需基础技能列表及熟练度 |
| combined_text | Text | | 合并文本（用于搜索） |
| embedding | Vector(1024) | | 向量嵌入 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 6.2 user_courses (用户课程关系表)

管理用户的课程学习进度。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| student_id | Integer | Primary Key, Foreign Key(students.id) | 学生ID |
| course_id | Integer | Primary Key, Foreign Key(courses.id) | 课程ID |
| progress | Float | Default=0.0 | 学习进度（0.0-1.0） |
| status | String | Default="in_progress" | 学习状态 |
| last_accessed | DateTime | Server Default=now(), On Update=now() | 最后访问时间 |
| created_at | DateTime | Server Default=now() | 开始学习时间 |

---

## 7. 积分系统和成就系统表

### 7.1 achievements (成就表)

定义平台中可获得的各种成就。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 成就唯一标识 |
| name | String | Unique, Not Null | 成就名称 |
| description | Text | Not Null | 成就描述 |
| criteria_type | String | Not Null | 达成成就的条件类型（如：PROJECT_COMPLETED_COUNT） |
| criteria_value | Float | Not Null | 达成成就所需的数值门槛 |
| badge_url | String | Nullable | 勋章图片或图标URL |
| reward_points | Integer | Default=0, Not Null | 达成此成就额外奖励的积分 |
| is_active | Boolean | Default=True, Not Null | 该成就是否启用 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 7.2 user_achievements (用户成就表)

记录用户获得的成就。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 用户成就唯一标识 |
| user_id | Integer | Foreign Key(students.id), Not Null | 用户ID |
| achievement_id | Integer | Foreign Key(achievements.id), Not Null | 成就ID |
| earned_at | DateTime | Server Default=now(), Not Null | 获得成就的时间 |
| is_notified | Boolean | Default=False, Not Null | 是否已通知用户 |

**约束**: UniqueConstraint(user_id, achievement_id) - 确保一个用户不会重复获得同一个成就

### 7.3 point_transactions (积分交易记录表)

记录用户积分的所有变动历史。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 积分交易唯一标识 |
| user_id | Integer | Foreign Key(students.id), Not Null | 用户ID |
| amount | Integer | Not Null | 积分变动金额（正数获得，负数消耗） |
| reason | String | Nullable | 积分���动理由描述 |
| transaction_type | String | Not Null | 积分交易类型（EARN, CONSUME, ADMIN_ADJUST等） |
| related_entity_type | String | Nullable | 关联的实体类型 |
| related_entity_id | Integer | Nullable | 关联实体的ID |
| created_at | DateTime | Server Default=now(), Not Null | 交易时间 |

---

## 8. 系统配置表

### 8.1 user_mcp_configs (用户MCP配置表)

存储用户的MCP（Model Context Protocol）配置。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 配置唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 配置所有者ID |
| name | String | Not Null | 配置名称 |
| mcp_type | String | Nullable | MCP类型 |
| base_url | String | Not Null | 基础URL |
| protocol_type | String | Nullable | 协议类型 |
| api_key_encrypted | Text | Nullable | 加密的API密钥 |
| is_active | Boolean | Default=True | 是否启用 |
| description | Text | Nullable | 配置描述 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 8.2 user_search_engine_configs (搜索引擎配置表)

存储用户的搜索引擎配置。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 配置唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 配置所有者ID |
| name | String | Not Null | 配置名称 |
| engine_type | String | Not Null | 搜索引擎类型 |
| api_key_encrypted | Text | Nullable | 加密的API密钥 |
| is_active | Boolean | Default=True | 是否启用 |
| description | Text | Nullable | 配置描述 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

### 8.3 user_tts_configs (用户TTS语音配置表)

存储用户的TTS（文本转语音）配置信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | Primary Key, Auto Increment | 配置唯一标识 |
| owner_id | Integer | Foreign Key(students.id), Not Null | 配置所有者ID |
| name | String | Not Null | TTS配置名称，如：'我的OpenAI语音' |
| tts_type | String | Not Null | 语音提供商类型，如：'openai', 'gemini', 'aliyun' |
| api_key_encrypted | Text | Nullable | 加密后的API密钥 |
| base_url | String | Nullable | API基础URL |
| model_id | String | Nullable | 语音模型ID，如：'tts-1', 'gemini-pro' |
| voice_name | String | Nullable | 语音名称或ID，如：'alloy', 'f_cn_zh_anqi_a_f' |
| is_active | Boolean | Default=False, Not Null | 是否当前激活的TTS配置 |
| created_at | DateTime | Server Default=now() | 创建时间 |
| updated_at | DateTime | On Update=now() | 更新时间 |

**约束**: UniqueConstraint(owner_id, name) - 同一个用户下配置名称唯一

---

## 数据库关系说明

### 主要外键关系

1. **用户相关关系**
   - `projects.creator_id` → `students.id`
   - `notes.owner_id` → `students.id`
   - `chat_rooms.creator_id` → `students.id`
   - `forum_topics.owner_id` → `students.id`

2. **聊天系统关系**
   - `chat_messages.room_id` → `chat_rooms.id`
   - `chat_messages.sender_id` → `students.id`
   - `chat_room_members.room_id` → `chat_rooms.id`
   - `chat_room_members.member_id` → `students.id`

3. **知识库关系**
   - `knowledge_articles.kb_id` → `knowledge_bases.id`
   - `knowledge_documents.kb_id` → `knowledge_bases.id`
   - `knowledge_document_chunks.document_id` → `knowledge_documents.id`

4. **积分系统关系**
   - `user_achievements.user_id` → `students.id`
   - `user_achievements.achievement_id` → `achievements.id`
   - `point_transactions.user_id` → `students.id`

### 向量搜索字段

系统使用pgvector扩展支持向量相似度搜索，以下表包含embedding字段：
- `students.embedding` - 用户技能和兴趣的向量表示
- `projects.embedding` - 项目需求的向量表示
- `forum_topics.embedding` - 论坛主题的向量表示
- `knowledge_articles.embedding` - 知识文章的向量表示
- `notes.embedding` - 笔记内容的向量表示
- `daily_records.embedding` - 日常记录的向量表示
- `collected_contents.embedding` - 收藏内容的向量表示
- `knowledge_document_chunks.embedding` - 文档分块的向量表示

这些向量字段支持AI驱动的智能匹配、推荐和搜索功能。

---

*文档最后更新时间：2025年8月11日*
