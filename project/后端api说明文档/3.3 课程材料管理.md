
---

# **鸿庆书云创新协作平台后端API文档 - 3.3 课程材料管理**

## **目录**

3. **课程材料管理**
 * 3.3.1 `POST /courses/{course_id}/materials/` 为指定课程上传新材料（文件或链接）
 * 3.3.2 `GET /courses/{course_id}/materials/` 获取指定课程的所有材料列表
 * 3.3.3 `GET /courses/{course_id}/materials/{material_id}` 获取指定课程材料详情
 * 3.3.4 `PUT /courses/{course_id}/materials/{material_id}` 更新指定课程材料
 * 3.3.5 `DELETE /courses/{course_id}/materials/{material_id}` 删除指定课程材料

---

## **公共基础模型 `schemas.CourseMaterialCreate` 和 `schemas.CourseMaterialResponse`**

### `schemas.CourseMaterialCreate` (用于创建请求)

* `title` (str): 材料标题。
* `type` (Literal["file", "link", "text"]): 材料类型。
 * `"file"`：表示上传文件。
 * `"link"`：表示外部链接。
 * `"text"`：表示纯文本内容。
* `url` (Optional[str]): 外部资源链接（当 `type` 为 `"link"` 时必填）。
* `content` (Optional[str]): 文本内容或描述（当 `type` 为 `"text"` 时必填）。
* `original_filename` (Optional[str]): 原始文件名（当 `type` 为 `"file"` 时由系统填充）。
* `file_type` (Optional[str]): 文件MIME类型（当 `type` 为 `"file"` 时由系统填充）。
* `size_bytes` (Optional[int]): 文件大小（字节，当 `type` 为 `"file"` 时由系统填充）。

### `schemas.CourseMaterialUpdate` (用于更新请求)

* 所有字段均为 `Optional`，只更新提供的字段。字段定义与 `CourseMaterialCreate` 相同。

### `schemas.CourseMaterialResponse` (用于响应体)

* `id` (int): 材料ID。
* `course_id` (int): 所属课程ID。
* `title` (str): 材料标题。
* `type` (Literal["file", "link", "text"]): 材料类型。
* `url` (Optional[str]): 外部资源链接。
* `content` (Optional[str]): 文本内容或描述。
* `original_filename` (Optional[str]): 原始文件名。
* `file_type` (Optional[str]): 文件MIME类型。
* `size_bytes` (Optional[int]): 文件大小（字节）。
* `file_path` (Optional[str]): 服务器内部文件路径（**仅供内部调试，不应直接暴露给前端作为可访问URL**）。
* `combined_text` (Optional[str]): 用于AI模型的组合文本（系统内部生成）。
* `embedding` (Optional[List[float]]): 材料内容的嵌入向量（系统内部生成）。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。

---

## **3.3 课程材料管理**

### **3.3.1 `POST /courses/{course_id}/materials/` 为指定课程上传新材料（文件或链接）**

* **摘要**: 为指定课程上传新的学习材料。支持文件上传、外部链接定义和纯文本内容。材料内容组合文本和嵌入向量会根据管理员的LLM配置自动生成。
* **权限**: 系统管理员。
* **路径参数**:
 * `course_id` (int): 要添加材料的课程ID。
* **请求体**: `multipart/form-data`（包含文件）或 `application/json`（不包含文件）。
 * **文件上传 (`type="file"`) 示例**:
 * `file` (File): 要上传的课程文件 (例如 PDF, DOCX, 视频等)。
 * `material_data` (Form, `schemas.CourseMaterialCreate`):
 * `title` (str): 材料标题。
 * `type` (Literal["file"]): 必须为 "file"。
 * `content` (Optional[str]): 可选的文件描述。
 * **链接材料 (`type="link"`) 示例**:
 * `material_data` (JSON, `schemas.CourseMaterialCreate`):
 * `title` (str): 材料标题。
 * `type` (Literal["link"]): 必须为 "link"。
 * `url` (str): 外部链接URL。
 * `content` (Optional[str]): 可选的链接描述。
 * **文本材料 (`type="text"`) 示例**:
 * `material_data` (JSON, `schemas.CourseMaterialCreate`):
 * `title` (str): 材料标题。
 * `type` (Literal["text"]): 必须为 "text"。
 * `content` (str): 纯文本内容。
* **响应体**: `schemas.CourseMaterialResponse`
* **常见状态码**: `200 OK` (创建成功), `400 Bad Request` (参数错误，如类型与数据不匹配，`url`或`content`缺失), `401 Unauthorized` (未认证), `403 Forbidden` (非管理员), `404 Not Found` (课程不存在), `409 Conflict` (同一课程下材料标题重复), `500 Internal Server Error` (文件保存或数据库错误)

### **3.3.2 `GET /courses/{course_id}/materials/` 获取指定课程的所有材料列表**

* **摘要**: 获取指定课程的所有学习材料的概要列表。
* **权限**: 已认证用户（只要课程存在即可查看其材料）。
* **路径参数**:
 * `course_id` (int): 要查询材料的课程ID。
* **查询参数**:
 * `type_filter` (Optional[Literal["file", "link", "text"]]): 可选的材料类型筛选。
* **响应体**: `List[schemas.CourseMaterialResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `404 Not Found` (课程不存在)

### **3.3.3 `GET /courses/{course_id}/materials/{material_id}` 获取指定课程材料详情**

* **摘要**: 获取指定课程下指定材料的详细信息。
* **权限**: 已认证用户（只要课程存在即可查看其材料）。
* **路径参数**:
 * `course_id` (int): 所属课程ID。
 * `material_id` (int): 材料的唯一标识符。
* **响应体**: `schemas.CourseMaterialResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `404 Not Found` (材料未找到或不属于该课程)

### **3.3.4 `PUT /courses/{course_id}/materials/{material_id}` 更新指定课程材料**

* **摘要**: 更新指定课程材料的详细信息。支持更改材料类型（例如从链接改为文件），并自动处理文件替换和旧文件删除。材料内容组合文本和嵌入向量会在更新后自动重新计算。
* **权限**: 系统管理员。
* **路径参数**:
 * `course_id` (int): 所属课程ID。
 * `material_id` (int): 要更新的材料ID。
* **请求体**: `multipart/form-data`（包含文件）或 `application/json`（不包含文件）。
 * `file` (Optional[File]): 可选的要上传的新文件。如果提供了文件，材料类型将被强制设为 `"file"`，并替换旧文件。
 * `material_data` (Form/JSON, `schemas.CourseMaterialUpdate`):
 * 所有字段均为 `Optional`。只更新提供的字段。
 * `title` (Optional[str]): 材料标题。**注意：标题不能为空。**
 * `type` (Optional[Literal["file", "link", "text"]]): 材料类型。如果更改类型，需符合对应类型的字段要求。
 * `url` (Optional[str]): 外部资源链接（当 `type` 为 `"link"` 时需提供）。
 * `content` (Optional[str]): 文本内容或描述（当 `type` 为 `"text"` 时需提供）。
* **响应体**: `schemas.CourseMaterialResponse`
* **常见状态码**: `200 OK` (更新成功), `400 Bad Request` (参数错误，如标题为空，类型与数据不匹配，或不允许文件上传), `401 Unauthorized` (未认证), `403 Forbidden` (非管理员), `404 Not Found` (材料未找到或不属于该课程), `409 Conflict` (同一课程下材料标题重复), `500 Internal Server Error` (文件保存或数据库错误)

### **3.3.5 `DELETE /courses/{course_id}/materials/{material_id}` 删除指定课程材料**

* **摘要**: 删除指定课程下的指定材料。如果材料是文件类型，会同时删除服务器上对应的物理文件。
* **权限**: 系统管理员。
* **路径参数**:
 * `course_id` (int): 所属课程ID。
 * `material_id` (int): 要删除的材料ID。
* **响应体**: 空响应体 (`204 No Content`)。
* **常见状态码**: `204 No Content` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (非管理员), `404 Not Found` (材料未找到或不属于该课程)

