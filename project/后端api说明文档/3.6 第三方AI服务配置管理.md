
---

# **鸿庆书云创新协作平台后端API文档 - 3.6 第三方AI服务配置管理**

## **目录**

6. **第三方AI服务配置管理**
 * 3.6.1 MCP（多模态计算平台）服务配置
 * 3.6.2 搜索引擎服务配置
 * 3.6.3 TTS（文本转语音）服务配置

---

## **公共基础模型**

### `schemas.UserMcpConfigCreate` (用于创建MCP配置)

* `name` (str): 配置名称，用户自定义，用于区分。
* `mcp_type` (str): MCP服务类型（例如`"modelscope_community"`，`"custom_mcp"`）。
* `base_url` (str): MCP服务的API基础URL。
* `protocol_type` (Literal["http_rest", "sse", "websocket", "streamable_http"]): 服务通信协议类型。
* `api_key` (Optional[str]): MCP服务的API密钥（明文），会加密存储。
* `is_active` (bool): 该配置是否启用。
* `description` (Optional[str]): 配置描述。

### `schemas.UserMcpConfigResponse` (用于MCP配置响应)

* `id` (int): 配置ID。
* `owner_id` (int): 配置所属用户ID。
* `name` (str): 配置名称。
* `mcp_type` (str): MCP服务类型。
* `base_url` (str): MCP服务的API基础URL。
* `protocol_type` (str): 服务通信协议类型。
* `is_active` (bool): 是否启用。
* `description` (Optional[str]): 配置描述。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。
* `api_key_encrypted` (Optional[str]): 加密后的API密钥（实际返回的是加密字符串的表示，不会暴露明文）。

### `schemas.McpStatusResponse` (用于MCP连通性检查响应)

* `status` (Literal["success", "failure", "timeout"]): 连通性状态。
* `message` (str): 详细状态信息。
* `service_name` (str): 服务的名称。
* `config_id` (int): 配置ID。
* `timestamp` (datetime): 检查时间戳。

### `schemas.McpToolDefinition` (用于MCP工具定义)

* `tool_id` (str): 工具的唯一标识符。
* `name` (str): 工具的对外显示名称。
* `description` (str): 工具功能描述。
* `mcp_config_id` (int): 关联的MCP配置ID。
* `mcp_config_name` (str): 关联的MCP配置名称。
* `input_schema` (Dict[str, Any]): 工具输入参数的JSON Schema定义。
* `output_schema` (Dict[str, Any]): 工具输出结果的JSON Schema定义。

### `schemas.UserSearchEngineConfigCreate` (用于创建搜索引擎配置)

* `name` (str): 配置名称。
* `engine_type` (Literal["baidu", "tavily", "custom_api"]): 搜索引擎类型。
* `api_key` (str): 搜索引擎API密钥（明文），会加密存储。
* `base_url` (Optional[str]): 搜索引擎API基础URL（对于`custom_api`类型可能需要）。
* `is_active` (bool): 该配置是否启用。
* `description` (Optional[str]): 配置描述。

### `schemas.UserSearchEngineConfigResponse` (用于搜索引擎配置响应)

* `id` (int): 配置ID。
* `owner_id` (int): 配置所属用户ID。
* `name` (str): 配置名称。
* `engine_type` (str): 搜索引擎类型。
* `base_url` (Optional[str]): 搜索引擎API基础URL。
* `is_active` (bool): 是否启用。
* `description` (Optional[str]): 配置描述。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。
* `api_key_encrypted` (Optional[str]): 加密后的API密钥（不会暴露明文）。

### `schemas.SearchEngineStatusResponse` (用于搜索引擎连通性检查响应)

* `status` (Literal["success", "failure", "timeout"]): 连通性状态。
* `message` (str): 详细状态信息。
* `engine_name` (str): 搜索引擎配置名称。
* `config_id` (int): 配置ID。
* `timestamp` (datetime): 检查时间戳。

### `schemas.UserTTSConfigCreate` (用于创建TTS配置)

* `name` (str): 配置名称。
* `tts_type` (Literal["volcano_engine", "custom_api"]): TTS服务类型。
* `api_key` (Optional[str]): TTS服务的API密钥（明文），会加密存储。
* `base_url` (Optional[str]): TTS服务API基础URL。
* `model_id` (Optional[str]): TTS模型ID。
* `voice_name` (Optional[str]): TTS音色名称。
* `is_active` (bool): 该配置是否启用，每个用户只能有一个激活的TTS配置。

### `schemas.UserTTSConfigUpdate` (用于更新TTS配置)

* 所有字段均为 `Optional`，只更新提供的字段。字段定义与 `UserTTSConfigCreate` 相同。

### `schemas.UserTTSConfigResponse` (用于TTS配置响应)

* `id` (int): 配置ID。
* `owner_id` (int): 配置所属用户ID。
* `name` (str): 配置名称。
* `tts_type` (str): TTS服务类型。
* `base_url` (Optional[str]): TTS服务基础URL。
* `model_id` (Optional[str]): TTS模型ID。
* `voice_name` (Optional[str]): TTS音色名称。
* `is_active` (bool): 是否启用。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。
* `api_key_encrypted` (Optional[str]): 加密后的API密钥（不会暴露明文）。

---

## **3.6 第三方AI服务配置管理**

### **3.6.1 MCP（多模态计算平台）服务配置**

#### **3.6.1.1 `POST /mcp-configs/` 创建新的MCP配置**

* **摘要**: 为当前用户创建新的多模态计算平台（MCP）服务配置。
* **权限**: 已认证用户。
* **请求体**: `schemas.UserMcpConfigCreate`
* **响应体**: `schemas.UserMcpConfigResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `409 Conflict` (已存在同名且活跃的配置，或并发冲突)

#### **3.6.1.2 `GET /mcp-configs/` 获取当前用户所有MCP服务配置**

* **摘要**: 获取当前认证用户配置的所有MCP服务列表。
* **权限**: 已认证用户。
* **查询参数**:
 * `is_active` (Optional[bool]): 过滤条件，`True` 只获取启用的配置，`False` 只获取禁用的配置。
* **响应体**: `List[schemas.UserMcpConfigResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

#### **3.6.1.3 `PUT /mcp-configs/{config_id}` 更新指定MCP配置**

* **摘要**: 更新当前用户指定的MCP服务配置。API密钥会加密存储。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要更新的MCP配置ID。
* **请求体**: `schemas.UserMcpConfigCreate` (所有字段皆为Optional，只更新传入的字段)
 * `api_key` (Optional[str]): 如果提供，将覆盖原加密密钥；如果为空字符串，则清空密钥。
* **响应体**: `schemas.UserMcpConfigResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在), `409 Conflict` (新名称与现有活跃配置冲突)

#### **3.6.1.4 `DELETE /mcp-configs/{config_id}` 删除指定MCP服务配置**

* **摘要**: 删除当前用户指定的MCP服务配置。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要删除的MCP配置ID。
* **响应体**: 空响应体 (`204 No Content`)。
* **常见状态码**: `204 No Content` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在)

#### **3.6.1.5 `POST /mcp-configs/{config_id}/check-status` 检查指定MCP服务的连通性**

* **摘要**: 检查指定ID的MCP服务配置的API连通性。模拟ping服务的健康检查端点。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要检查的MCP配置ID。
* **请求体**: 无。
* **响应体**: `schemas.McpStatusResponse`
* **常见状态码**: `200 OK` (返回状态报告，即使失败也是200并附带`"status": "failure"`), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在)

#### **3.6.1.6 `GET /llm/mcp-available-tools` 获取智库聊天可用的MCP工具列表**

* **摘要**: 根据用户已配置且启用的MCP服务，返回可用于智库聊天中的工具列表，如可视化图表生成、文生图等。
* **权限**: 已认证用户。
* **请求体**: 无。
* **响应体**: `List[schemas.McpToolDefinition]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

### **3.6.2 搜索引擎服务配置**

#### **3.6.2.1 `POST /search-engine-configs/` 创建新的搜索引擎配置**

* **摘要**: 为当前用户创建新的搜索引擎配置。
* **权限**: 已认证用户。
* **请求体**: `schemas.UserSearchEngineConfigCreate`
* **响应体**: `schemas.UserSearchEngineConfigResponse`
* **常见状态码**: `200 OK` (创建成功), `400 Bad Request` (API密钥为空), `401 Unauthorized` (未认证), `409 Conflict` (已存在同名且活跃的配置，或并发冲突)

#### **3.6.2.2 `GET /search-engine-configs/` 获取当前用户所有搜索引擎配置**

* **摘要**: 获取当前认证用户配置的所有搜索引擎列表。
* **权限**: 已认证用户。
* **查询参数**:
 * `is_active` (Optional[bool]): 过滤条件，`True` 只获取启用的配置，`False` 只获取禁用的配置。
* **响应体**: `List[schemas.UserSearchEngineConfigResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

#### **3.6.2.3 `GET /search-engine-configs/{config_id}` 获取指定搜索引擎配置详情**

* **摘要**: 获取指定ID搜索引擎配置的详细信息。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 搜索引擎配置ID。
* **响应体**: `schemas.UserSearchEngineConfigResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在)

#### **3.6.2.4 `PUT /search-engine-configs/{config_id}` 更新指定搜索引擎配置**

* **摘要**: 更新当前用户指定的搜索引擎配置。API密钥会加密存储。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要更新的搜索引擎配置ID。
* **请求体**: `schemas.UserSearchEngineConfigCreate` (所有字段皆为Optional，只更新传入的字段)
 * `api_key` (Optional[str]): 如果提供，将覆盖原加密密钥；如果为空字符串，则清空密钥。
* **响应体**: `schemas.UserSearchEngineConfigResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在), `409 Conflict` (新名称与现有活跃配置冲突)

#### **3.6.2.5 `DELETE /search-engine-configs/{config_id}` 删除指定搜索引擎配置**

* **摘要**: 删除当前用户指定的搜索引擎配置。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要删除的搜索引擎配置ID。
* **响应体**: 空响应体 (`204 No Content`)。
* **常见状态码**: `204 No Content` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在)

#### **3.6.2.6 `POST /search-engine-configs/{config_id}/check-status` 检查指定搜索引擎的连通性**

* **摘要**: 检查指定ID的搜索引擎配置的API连通性。会尝试执行一次简化的搜索请求以验证服务。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要检查的搜索引擎配置ID。
* **请求体**: 无。
* **响应体**: `schemas.SearchEngineStatusResponse`
* **常见状态码**: `200 OK` (返回状态报告), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在), `500 Internal Server Error` (密钥解密失败), `503 Service Unavailable` (搜索API调用失败)

### **3.6.3 TTS（文本转语音）服务配置**

#### **3.6.3.1 `POST /users/me/tts_configs` 为当前用户创建新的TTS配置**

* **摘要**: 为当前认证用户创建新的文本转语音（Text-to-Speech, TTS）服务配置。
* **权限**: 已认证用户。
* **请求体**: `schemas.UserTTSConfigCreate`
* **响应体**: `schemas.UserTTSConfigResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `409 Conflict` (已存在同名配置或已有激活配置)

#### **3.6.3.2 `GET /users/me/tts_configs` 获取当前用户的所有TTS配置**

* **摘要**: 获取当前认证用户配置的所有TTS服务列表。
* **权限**: 已认证用户。
* **响应体**: `List[schemas.UserTTSConfigResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

#### **3.6.3.3 `GET /users/me/tts_configs/{config_id}` 获取指定TTS配置详情**

* **摘要**: 获取指定ID TTS配置的详细信息。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): TTS配置ID。
* **响应体**: `schemas.UserTTSConfigResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在)

#### **3.6.3.4 `PUT /users/me/tts_configs/{config_id}` 更新指定TTS配置**

* **摘要**: 更新当前用户指定的TTS服务配置。API密钥会加密存储。如果`is_active`被设置为`True`，则其他所有TTS配置将自动被设为不活跃。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要更新的TTS配置ID。
* **请求体**: `schemas.UserTTSConfigUpdate` (所有字段皆为Optional，只更新传入的字段)
 * `api_key` (Optional[str]): 如果提供，将覆盖原加密密钥；如果为空字符串，则清空密钥。
* **响应体**: `schemas.UserTTSConfigResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在), `409 Conflict` (新名称与现有配置冲突，或试图同时激活多个配置)

#### **3.6.3.5 `DELETE /users/me/tts_configs/{config_id}` 删除指定TTS配置**

* **摘要**: 删除当前用户指定的TTS服务配置。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要删除的TTS配置ID。
* **响应体**: 空响应体 (`204 No Content`)。
* **常见状态码**: `204 No Content` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在)

#### **3.6.3.6 `PUT /users/me/tts_configs/{config_id}/set_active` 设置指定TTS配置为激活状态**

* **摘要**: 将当前用户的某个TTS配置设置为激活状态。同时，用户所有其他TTS配置（如果有）将自动被设为不活跃。
* **权限**: 配置所有者。
* **路径参数**:
 * `config_id` (int): 要激活的TTS配置ID。
* **请求体**: 无请求体。
* **响应体**: `schemas.UserTTSConfigResponse` (激活后的配置详情)。
* **常见状态码**: `200 OK` (成功激活), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (配置不存在)

