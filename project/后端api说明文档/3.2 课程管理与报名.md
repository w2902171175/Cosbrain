
---

# **鸿庆书云创新协作平台后端API文档 - 3.2 课程管理与报名**

## **目录**

1. **课程管理与报名**
 * 3.2.1 `POST /courses/` 创建新课程
 * 3.2.2 `GET /courses/` 获取所有课程列表
 * 3.2.3 `GET /courses/{course_id}` 获取指定课程详情
 * 3.2.4 `PUT /courses/{course_id}` 更新指定课程
 * 3.2.5 `POST /courses/{course_id}/enroll` 用户报名课程
 * 3.2.6 `PUT /users/me/courses/{course_id}` 更新当前用户课程学习进度和状态
 * 3.2.7 `GET /recommend/courses/{student_id}` 为指定学生推荐课程

---

## **公共基础模型 `schemas.SkillWithProficiency`**

* **`name`** (str): 技能名称。
* **`level`** (Literal["初窥门径", "登堂入室", "融会贯通", "炉火纯青"]): 技能熟练度等级。

---

## **3.2 课程管理与报名**

### **3.2.1 `POST /courses/` 创建新课程**

* **摘要**: 创建一个新课程。只有系统管理员可以操作。
* **权限**: 系统管理员。
* **请求体**: `schemas.CourseBase`
 * `title` (str): 课程标题。
 * `description` (Optional[str]): 课程描述。
 * `instructor` (Optional[str]): 讲师名称。
 * `category` (Optional[str]): 课程类别。
 * `total_lessons` (Optional[int]): 总课时数。
 * `avg_rating` (Optional[float]): 平均评分。
 * `cover_image_url` (Optional[str]): 课程封面图片URL。
 * `required_skills` (Optional[List[schemas.SkillWithProficiency]]): 学习该课程所需的基础技能或课程教授的技能列表。
* **响应体**: `schemas.CourseResponse`
 * `id` (int): 课程ID。
 * `embedding` (Optional[List[float]]): 课程内容的嵌入向量（系统内部生成，用于AI匹配）。
 * `combined_text` (Optional[str]): 用于AI模型嵌入的组合文本（系统内部生成）。
 * `created_at` (datetime): 创建时间。
 * `updated_at` (Optional[datetime]): 更新时间。
 * 其余字段同 `CourseBase`。
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `403 Forbidden` (非管理员), `409 Conflict` (数据冲突，例如同名课程)

### **3.2.2 `GET /courses/` 获取所有课程列表**

* **摘要**: 获取平台上所有课程的概要列表。
* **权限**: 已认证用户。
* **请求体**: 无。
* **响应体**: `List[schemas.CourseResponse]` (列表中的每个元素为 `schemas.CourseResponse`，不包含敏感信息)。
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

### **3.2.3 `GET /courses/{course_id}` 获取指定课程详情**

* **摘要**: 获取指定ID课程的详细信息。
* **权限**: 已认证用户。
* **路径参数**:
 * `course_id` (int): 课程的唯一标识符。
* **请求体**: 无。
* **响应体**: `schemas.CourseResponse` (同 `POST /courses/` 的响应体)。
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `404 Not Found` (课程不存在)

### **3.2.4 `PUT /courses/{course_id}` 更新指定课程**

* **摘要**: 更新指定ID课程的详细信息。只有系统管理员可以修改。课程内容的嵌入向量会在更新后自动重新计算。
* **权限**: 系统管理员。
* **路径参数**:
 * `course_id` (int): 课程ID。
* **请求体**: `schemas.CourseUpdate`
 * 所有字段均为 `Optional`，只更新提供的字段。
 * `title` (Optional[str]): 课程标题。
 * `description` (Optional[str]): 课程描述。
 * `instructor` (Optional[str]): 讲师名称。
 * `category` (Optional[str]): 课程类别。
 * `total_lessons` (Optional[int]): 总课时数。
 * `avg_rating` (Optional[float]): 平均评分。
 * `cover_image_url` (Optional[str]): 课程封面图片URL。
 * `required_skills` (Optional[List[schemas.SkillWithProficiency]]): 所需技能列表。
* **响应体**: `schemas.CourseResponse` (更新后的课程详情)。
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (非管理员), `404 Not Found` (课程不存在), `409 Conflict` (数据冲突)

### **3.2.5 `POST /courses/{course_id}/enroll` 用户报名课程**

* **摘要**: 允许当前认证用户报名（注册）一门课程。如果用户已报名，则返回已有的报名信息，不会重复创建。
* **权限**: 已认证用户。
* **路径参数**:
 * `course_id` (int): 要报名的课程ID。
* **请求体**: 无。
* **响应体**: `schemas.UserCourseResponse`
 * `id` (int): 用户课程关联记录ID。
 * `student_id` (int): 报名学生ID。
 * `course_id` (int): 报名课程ID。
 * `progress` (float): 学习进度（0.0 - 1.0），初始为 `0.0`。
 * `status` (Literal["registered", "in_progress", "completed", "dropped"]): 学习状态，初始为 `"registered"`。
 * `last_accessed` (datetime): 最后访问时间。
 * `created_at` (datetime): 报名时间。
 * `updated_at` (Optional[datetime]): 更新时间。
 * `course_title`(Optional[str]): 关联课程的标题 (方便前端显示)。
* **常见状态码**: `200 OK` (报名成功或已报名), `401 Unauthorized` (未认证), `404 Not Found` (课程不存在), `409 Conflict` (并发冲突)

### **3.2.6 `PUT /users/me/courses/{course_id}` 更新当前用户课程学习进度和状态**

* **摘要**: 更新当前用户对指定课程的学习进度和状态。当课程状态变为“`completed`” 时，会触发积分奖励和成就检查。
* **权限**: 已认证用户（用户只能更新自己的课程）。
* **路径参数**:
 * `course_id` (int): 要更新的课程ID。
* **请求体**: 字典 (`Dict[str, Any]`)。由于Pydantic验证，请确保字段名称和类型正确。
 * `progress` (Optional[float]): 学习进度（0.0 - 1.0）。
 * `status` (Optional[Literal["registered", "in_progress", "completed", "dropped"]]): 学习状态。
* **响应体**: `schemas.UserCourseResponse` (更新后的用户课程关联记录详情)。
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `404 Not Found` (用户未注册该课程或课程不存在), `500 Internal Server Error` (数据保存失败)

### **3.2.7 `GET /recommend/courses/{student_id}` 为指定学生推荐课程**

* **摘要**: 使用AI为指定学生推荐相关的课程。推荐逻辑综合考虑文本内容相似度、技能匹配。
* **权限**: 已认证用户。（在实际业务中，可以限制为学生本人或管理员才能为其推荐）。
* **路径参数**:
 * `student_id` (int): 学生的唯一标识符。
* **查询参数**:
 * `initial_k` (int, default=50): 初步筛选要返回的候选数量。
 * `final_k` (int, default=3): 最终重排后返回的推荐数量。
* **请求体**: 无。
* **响应体**: `List[schemas.MatchedCourse]`
 * `course_id` (int): 推荐课程的ID。
 * `title` (str): 课程标题。
 * `description` (str): 课程描述。
 * `instructor` (Optional[str]): 讲师名称。
 * `category` (Optional[str]): 课程类别。
 * `cover_image_url` (Optional[str]): 课程封面URL。
 * `similarity_stage1` (float): 第一阶段（粗召回/综合匹配）的相似度得分。
 * `relevance_score` (float): 最终重排后的相关性得分（如果重排成功，则更准确）。
 * `match_rationale` (Optional[str]): AI生成的匹配理由和行动建议。
* **常见状态码**: `200 OK` (成功获取推荐), `404 Not Found` (学生或课程不存在，或无匹配推荐), `500 Internal Server Error` (AI服务失败)

---
