
---

# **鸿庆书云创新协作平台后端API文档 - 3.8 文件夹与收藏管理**

## **目录**

8. **文件夹与收藏管理**
 * 3.8.1 `POST /folders/` 创建新文件夹
 * 3.8.2 `GET /folders/` 获取当前用户所有文件夹
 * 3.8.3 `GET /folders/{folder_id}` 获取指定文件夹详情
 * 3.8.4 `PUT /folders/{folder_id}` 更新指定文件夹
 * 3.8.5 `DELETE /folders/{folder_id}` 删除指定文件夹
 * 3.8.6 `POST /collections/` 创建新收藏内容
 * 3.8.7 `POST /collections/add-from-platform` 快速收藏平台内部内容（课程、项目、话题等）
 * 3.8.8 `GET /collections/` 获取当前用户所有收藏内容
 * 3.8.9 `GET /collections/{content_id}` 获取指定收藏内容详情
 * 3.8.10 `PUT /collections/{content_id}` 更新指定收藏内容
 * 3.8.11 `DELETE /collections/{content_id}` 删除指定收藏内容

---

## **公共基础模型**

### `schemas.FolderBase` (用于创建和更新文件夹请求)

* `name` (str): 文件夹名称。
* `description` (Optional[str]): 文件夹描述。
* `color` (Optional[str]): 文件夹颜色（例如：`"#FFC0CB"`）。
* `icon` (Optional[str]): 文件夹图标（例如：`"folder_open"`）。
* `parent_id` (Optional[int]): 父文件夹ID，用于创建嵌套文件夹。顶级文件夹为 `None`。
* `order` (Optional[int]): 文件夹在同级中的显示顺序。

### `schemas.FolderResponse` (用于文件夹响应)

* `id` (int): 文件夹ID。
* `owner_id` (int): 文件夹所属用户ID。
* `name` (str): 文件夹名称。
* `description` (Optional[str]): 文件夹描述。
* `color` (Optional[str]): 文件夹颜色。
* `icon` (Optional[str]): 文件夹图标。
* `parent_id` (Optional[int]): 父文件夹ID。
* `order` (Optional[int]): 顺序。
* `item_count` (int): 文件夹中直属内容项（收藏和子文件夹）的数量（辅助字段）。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。

### `schemas.CollectedContentBase` (用于通用收藏创建和更新请求)

* `title` (str): 收藏内容的标题。
* `type` (Literal["url", "text", "image", "file", "custom", "project", "course", "forum_topic", "note", "daily_record", "knowledge_article", "chat_message", "knowledge_document"]): 收藏内容类型。
 * `"url"`: 外部链接。
 * `"text"`: 纯文本内容。
 * `"image"`: 图片。
 * `"file"`: 文件。
 * `"custom"`: 自定义类型。
 * `"project"`: 平台内部项目。
 * `"course"`: 平台内部课程。
 * `"forum_topic"`: 平台内部论坛话题。
 * `"note"`: 平台内部笔记。
 * `"daily_record"`: 平台内部随手记录。
 * `"knowledge_article"`: 平台内部知识库文章。
 * `"chat_message"`: 平台内部聊天消息。
 * `"knowledge_document"`: 平台内部知识文档。
* `url` (Optional[str]): 外部资源链接（当 `type` 为 `"url"`, `"image"`, `"file"` 时通常需要）。
* `content` (Optional[str]): 文本内容或描述（当 `type` 为 `"text"` 时常用）。
* `tags` (Optional[str]): 逗号分隔的标签。
* `priority` (Optional[int]): 优先级（例如：0-5）。
* `notes` (Optional[str]): 个人备注。
* `is_starred` (Optional[bool]): 是否星标。
* `thumbnail` (Optional[str]): 缩略图URL。
* `author` (Optional[str]): 内容作者。
* `duration` (Optional[int]): 时长（例如，视频/音频）。
* `file_size` (Optional[int]): 文件大小（字节）。
* `status` (Optional[str]): 内容状态（例如：“待办”，“已读”，“进行中”）。
* `folder_id` (Optional[int]): 所属文件夹ID。如果为 `None`，则表示在根目录；如果传入 `0` 也代表移到根目录。
* `shared_item_type` (Optional[Literal[...]]): 如果收藏平台内部内容，记录其类型。
* `shared_item_id` (Optional[int]): 如果收藏平台内部内容，记录其ID。

### `schemas.CollectedContentSharedItemAddRequest` (用于快速收藏平台内部内容请求)

* `shared_item_type` (Literal[...]): 要收藏的平台内部内容的类型。
* `shared_item_id` (int): 要收藏的平台内部内容的ID。
* `folder_id` (Optional[int]): 要收藏到的文件夹ID。
* `notes` (Optional[str]): 收藏时的个人备注。
* `is_starred` (Optional[bool]): 是否立即为该收藏添加星标。
* `title` (Optional[str]): 收藏项的自定义标题。如果为空，后端将从共享项中提取。

### `schemas.CollectedContentResponse` (用于收藏内容响应)

* `id` (int): 收藏内容ID。
* `owner_id` (int): 所属用户ID。
* `folder_id` (Optional[int]): 所属文件夹ID。
* `title` (str): 收藏标题。
* `type` (str): 收藏类型。
* `url` (Optional[str]): 资源链接。
* `content` (Optional[str]): 文本内容。
* `tags` (Optional[str]): 标签。
* `priority` (int): 优先级。
* `notes` (Optional[str]): 个人备注。
* `is_starred` (bool): 是否星标。
* `thumbnail` (Optional[str]): 缩略图URL。
* `author` (Optional[str]): 作者。
* `duration` (Optional[int]): 时长。
* `file_size` (Optional[int]): 文件大小。
* `status` (Optional[str]): 状态。
* `access_count` (int): 访问（查看）次数。
* `shared_item_type` (Optional[str]): 共享项类型。
* `shared_item_id` (Optional[int]): 共享项ID。
* `combined_text` (Optional[str]): 用于AI模型的组合文本。
* `embedding` (Optional[List[float]]): 嵌入向量。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。

---

## **3.8 文件夹与收藏管理**

### **3.8.1 `POST /folders/` 创建新文件夹**

* **摘要**: 为当前认证用户创建一个新文件夹。支持创建嵌套文件夹。
* **权限**: 已认证用户。
* **请求体**: `schemas.FolderBase`
* **响应体**: `schemas.FolderResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `404 Not Found` (父文件夹不存在或无权访问)

### **3.8.2 `GET /folders/` 获取当前用户所有文件夹**

* **摘要**: 获取当前认证用户的所有文件夹列表。可选择按 `parent_id` 过滤，以获取特定父文件夹下的子文件夹，或获取顶级文件夹（`parent_id` 为 `None`）。
* **权限**: 已认证用户。
* **查询参数**:
 * `parent_id` (Optional[int]): 过滤条件：如果提供ID，则只返回该ID下的子文件夹。如果未提供，则返回顶级文件夹（`parent_id` 为 `None` 的文件夹）。
* **响应体**: `List[schemas.FolderResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

### **3.8.3 `GET /folders/{folder_id}` 获取指定文件夹详情**

* **摘要**: 获取指定ID的文件夹详情。
* **权限**: 文件夹所有者。
* **路径参数**:
 * `folder_id` (int): 文件夹的唯一标识符。
* **响应体**: `schemas.FolderResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文件夹不存在)

### **3.8.4 `PUT /folders/{folder_id}` 更新指定文件夹**

* **摘要**: 更新指定ID的文件夹信息。只有文件夹所有者可以修改。支持更改父文件夹，但会进行循环依赖检查。
* **权限**: 文件夹所有者。
* **路径参数**:
 * `folder_id` (int): 要更新的文件夹ID。
* **请求体**: `schemas.FolderBase` (所有字段均为 `Optional`，只更新提供的字段)。
* **响应体**: `schemas.FolderResponse`
* **常见状态码**: `200 OK` (更新成功), `400 Bad Request` (循环依赖或尝试将自己设为父文件夹), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文件夹或新父文件夹不存在)

### **3.8.5 `DELETE /folders/{folder_id}` 删除指定文件夹**

* **摘要**: 删除指定ID的文件夹及其包含的所有子文件夹和收藏内容。
* **权限**: 文件夹所有者。
* **路径参数**:
 * `folder_id` (int): 要删除的文件夹ID。
* **响应体**: JSON对象 `{"message": "Folder and its contents deleted successfully"}`。
* **常见状态码**: `200 OK` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文件夹不存在)

---

### **3.8.6 `POST /collections/` 创建新收藏内容**

* **摘要**: 为当前认证用户创建一条新收藏内容。支持直接创建外部链接、文本、图片等类型的内容，也可以通过 `shared_item_type` 和 `shared_item_id` 来引用收藏平台内部资源。后端会根据内容和用户LLM配置（硅基流动）自动生成组合文本和嵌入向量。
* **权限**: 已认证用户。
* **请求体**: `schemas.CollectedContentBase`
 * `title` (str): 标题。
 * `type` (Literal[...]): 收藏类型。
 * `url` (Optional[str]): 外部链接。
 * `content` (Optional[str]): 文本内容。
 * `tags` (Optional[str]): 标签。
 * `folder_id` (Optional[int]): 所属文件夹ID。
 * `shared_item_type` (Optional[Literal[...]]): 内部平台内容的类型。
 * `shared_item_id` (Optional[int]): 内部平台内容的ID。
 * 其他 `CollectedContentBase` 字段。
* **响应体**: `schemas.CollectedContentResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `404 Not Found` (目标文件夹或共享项不存在), `409 Conflict` (此内容已被您收藏或并发冲突), `500 Internal Server Error` (AI嵌入生成失败)

### **3.8.7 `POST /collections/add-from-platform` 快速收藏平台内部内容（课程、项目、话题等）**

* **摘要**: 提供一个便捷接口，允许用户快速将平台内已有的资源（课程、项目、论坛话题、笔记、随手记录、知识库文章、聊天消息等）添加到其个人收藏中。后端将自动从源内容提取标题、类型、URL等信息。
* **权限**: 已认证用户。
* **请求体**: `schemas.CollectedContentSharedItemAddRequest`
 * `shared_item_type` (Literal[...]): 要收藏的平台内部内容的类型（必填）。
 * `shared_item_id` (int): 要收藏的平台内部内容的ID（必填）。
 * `folder_id` (Optional[int]): 要收藏到的文件夹ID。
 * `notes` (Optional[str]): 收藏时的个人备注。
 * `is_starred` (Optional[bool]): 是否立即为该收藏添加星标。
 * `title` (Optional[str]): 收藏项的自定义标题。如果为空，后端将从共享项中提取。
* **响应体**: `schemas.CollectedContentResponse`
* **常见状态码**: `200 OK` (收藏成功), `400 Bad Request` (不支持的共享项类型), `401 Unauthorized` (未认证), `404 Not Found` (目标文件夹或共享项不存在), `409 Conflict` (此内容已被您收藏或并发冲突), `500 Internal Server Error` (AI嵌入生成失败)

### **3.8.8 `GET /collections/` 获取当前用户所有收藏内容**

* **摘要**: 获取当前认证用户的所有收藏内容列表。支持通过文件夹ID、类型、标签、星标状态和内容状态进行多维度过滤。
* **权限**: 已认证用户。
* **查询参数**:
 * `folder_id` (Optional[int]): 过滤条件：如果提供ID，则只返回该文件夹下的收藏。如果为 `0`，则返回所有不在任何文件夹中的收藏（根目录）。如果为 `None`，则返回所有收藏（无论是否在文件夹中）。
 * `type_filter` (Optional[str]): 过滤条件：按收藏类型（例如`"url"`, `"project"`）过滤。
 * `tag_filter` (Optional[str]): 过滤条件：按标签进行模糊匹配。
 * `is_starred` (Optional[bool]): 过滤条件：`True` 只返回星标收藏。
 * `status_filter` (Optional[str]): 过滤条件：按内容状态过滤。
* **响应体**: `List[schemas.CollectedContentResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

### **3.8.9 `GET /collections/{content_id}` 获取指定收藏内容详情**

* **摘要**: 获取指定ID的收藏内容详情。每次访问会自动增加访问次数 (`access_count`)。
* **权限**: 收藏内容所有者。
* **路径参数**:
 * `content_id` (int): 收藏内容的唯一标识符。
* **响应体**: `schemas.CollectedContentResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (收藏内容不存在)

### **3.8.10 `PUT /collections/{content_id}` 更新指定收藏内容**

* **摘要**: 更新指定ID的收藏内容。只有内容所有者可以修改。支持移动到其他文件夹。更新后，内容的组合文本和嵌入向量会重新生成。
* **权限**: 收藏内容所有者。
* **路径参数**:
 * `content_id` (int): 要更新的收藏内容ID。
* **请求体**: `schemas.CollectedContentBase` (所有字段均为 `Optional`，只更新提供的字段)。
 * `folder_id` (Optional[int]): 新的所属文件夹ID。如果为`0`或`None`，表示移到根目录。
* **响应体**: `schemas.CollectedContentResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (收藏内容或目标文件夹不存在), `409 Conflict` (数据冲突，例如重复收藏的约束冲突), `500 Internal Server Error` (AI嵌入生成失败)

### **3.8.11 `DELETE /collections/{content_id}` 删除指定收藏内容**

* **摘要**: 删除指定ID的收藏内容。
* **权限**: 收藏内容所有者。
* **路径参数**:
 * `content_id` (int): 要删除的收藏内容ID。
* **响应体**: JSON对象 `{"message": "Collected content deleted successfully"}`。
* **常见状态码**: `200 OK` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (收藏内容不存在)
