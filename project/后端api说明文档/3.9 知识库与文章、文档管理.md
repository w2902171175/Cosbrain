
---

# **鸿庆书云创新协作平台后端API文档 - 3.9 知识库与文章、文档管理**

## **目录**

9. **知识库与文章、文档管理**
 * 3.9.1 知识库（Knowledge Base）管理
 * 3.9.2 知识文章（Knowledge Article）管理
 * 3.9.3 知识文档（Knowledge Document）上传与管理

---

## **公共基础模型**

### `schemas.KnowledgeBaseBase` (用于创建和更新知识库请求)

* `name` (str): 知识库名称。
* `description` (Optional[str]): 知识库描述。
* `access_type` (Literal["private", "public"]): 访问类型。
 * `"private"`: 只有拥有者可见。
 * `"public"`: 对所有用户可见（但只能由拥有者编辑）。

### `schemas.KnowledgeBaseResponse` (用于知识库响应)

* `id` (int): 知识库ID。
* `owner_id` (int): 知识库拥有者ID。
* `name` (str): 知识库名称。
* `description` (Optional[str]): 知识库描述。
* `access_type` (Literal["private", "public"]): 访问类型。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。

### `schemas.KnowledgeArticleBase` (用于创建和更新知识文章请求)

* `title` (str): 文章标题。
* `content` (Optional[str]): 文章内容（纯文本）。
* `version` (Optional[str]): 文章版本号。
* `tags` (Optional[str]): 逗号分隔的标签。

### `schemas.KnowledgeArticleResponse` (用于知识文章响应)

* `id` (int): 文章ID。
* `kb_id` (int): 所属知识库ID。
* `author_id` (int): 文章作者（用户）ID。
* `title` (str): 文章标题。
* `content` (Optional[str]): 文章内容。
* `version` (Optional[str]): 文章版本号。
* `tags` (Optional[str]): 标签。
* `combined_text` (Optional[str]): 用于AI模型的组合文本（系统内部生成）。
* `embedding` (Optional[List[float]]): 文章内容的嵌入向量（系统内部生成，用于AI语义搜索和RAG）。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。

### `schemas.KnowledgeDocumentResponse` (用于知识文档（文件）响应)

* `id` (int): 文档ID。
* `kb_id` (int): 所属知识库ID。
* `owner_id` (int): 文档上传者（拥有者）ID。
* `file_name` (str): 原始文件名。
* `file_path` (str): 服务器内部存储路径（**仅供调试，不直接暴露URL**）。
* `file_type` (str): 文件MIME类型。
* `status` (Literal["uploaded", "processing", "completed", "failed"]): 文档处理状态。
 * `"uploaded"`: 文件已接收。
 * `"processing"`: 正在提取文本、分块、生成嵌入。
 * `"completed"`: 处理完成，可用。
 * `"failed"`: 处理失败。
* `processing_message` (Optional[str]): 处理状态消息或错误信息。
* `total_chunks` (Optional[int]): 文档被分成的文本块数量。
* `created_at` (datetime): 上传时间。
* `updated_at` (Optional[datetime]): 更新时间。

### `schemas.KnowledgeDocumentChunkResponse` (用于知识文档文本块响应)

* `id` (int): 文本块ID。
* `document_id` (int): 所属文档ID。
* `kb_id` (int): 所属知识库ID。
* `owner_id` (int): 文本块拥有者ID。
* `chunk_index` (int): 文本块在文档中的索引。
* `content` (str): 文本块内容。
* `embedding` (List[float]): 文本块内容的嵌入向量。
* `created_at` (datetime): 创建时间。

---

## **3.9 知识库与文章、文档管理**

### **3.9.1 知识库（Knowledge Base）管理**

#### **3.9.1.1 `POST /knowledge-bases/` 创建新知识库**

* **摘要**: 为当前认证用户创建一个新的知识库。
* **权限**: 已认证用户。
* **请求体**: `schemas.KnowledgeBaseBase`
* **响应体**: `schemas.KnowledgeBaseResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `409 Conflict` (知识库名称已存在或并发冲突), `500 Internal Server Error` (数据库错误)

#### **3.9.1.2 `GET /knowledge-bases/` 获取当前用户所有知识库**

* **摘要**: 获取当前认证用户创建的所有知识库列表。
* **权限**: 已认证用户。
* **响应体**: `List[schemas.KnowledgeBaseResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

#### **3.9.1.3 `GET /knowledge-bases/{kb_id}` 获取指定知识库详情**

* **摘要**: 获取指定ID知识库的详细信息。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 知识库的唯一标识符。
* **响应体**: `schemas.KnowledgeBaseResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (知识库不存在)

#### **3.9.1.4 `PUT /knowledge-bases/{kb_id}` 更新指定知识库**

* **摘要**: 更新指定ID知识库的详细信息（如名称、描述、访问类型）。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 要更新的知识库ID。
* **请求体**: `schemas.KnowledgeBaseBase` (所有字段均为 `Optional`，只更新提供的字段)。
* **响应体**: `schemas.KnowledgeBaseResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (知识库不存在), `409 Conflict` (新知识库名称已存在)

#### **3.9.1.5 `DELETE /knowledge-bases/{kb_id}` 删除指定知识库**

* **摘要**: 删除指定ID的知识库。同时会级联删除该知识库下的所有文章和文档（及其文本块）。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 要删除的知识库ID。
* **响应体**: JSON对象 `{"message": "Knowledge base and its articles/documents deleted successfully"}`。
* **常见状态码**: `200 OK` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (知识库不存在)

### **3.9.2 知识文章（Knowledge Article）管理**

#### **3.9.2.1 `POST /knowledge-bases/{kb_id}/articles/` 在指定知识库中创建新文章**

* **摘要**: 在指定的知识库中创建一篇新的知识文章。文章内容会生成组合文本和嵌入向量。嵌入向量的生成依赖于文章作者配置的硅基流动LLM API密钥。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 要创建文章的知识库ID。
* **请求体**: `schemas.KnowledgeArticleBase`
* **响应体**: `schemas.KnowledgeArticleResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (知识库不存在)

#### **3.9.2.2 `GET /knowledge-bases/{kb_id}/articles/` 获取指定知识库的所有文章**

* **摘要**: 获取指定知识库下的所有知识文章列表。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 要查询文章的知识库ID。
* **响应体**: `List[schemas.KnowledgeArticleResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (知识库不存在)

#### **3.9.2.3 `GET /articles/{article_id}` 获取指定文章详情**

* **摘要**: 获取指定ID知识文章的详细信息。
* **权限**: 文章作者。
* **路径参数**:
 * `article_id` (int): 文章的唯一标识符。
* **响应体**: `schemas.KnowledgeArticleResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文章不存在)

#### **3.9.2.4 `PUT /articles/{article_id}` 更新指定文章**

* **摘要**: 更新指定ID知识文章的内容。只有文章作者可以修改。更新后，文章的组合文本和嵌入向量会重新生成。
* **权限**: 文章作者。
* **路径参数**:
 * `article_id` (int): 要更新的文章ID。
* **请求体**: `schemas.KnowledgeArticleBase` (所有字段均为 `Optional`，只更新提供的字段)。
* **响应体**: `schemas.KnowledgeArticleResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文章不存在), `500 Internal Server Error` (AI嵌入生成失败)

#### **3.9.2.5 `DELETE /articles/{article_id}` 删除指定文章**

* **摘要**: 删除指定ID的知识文章。
* **权限**: 文章作者。
* **路径参数**:
 * `article_id` (int): 要删除的文章ID。
* **响应体**: JSON对象 `{"message": "Knowledge article deleted successfully"}`。
* **常见状态码**: `200 OK` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文章不存在)

### **3.9.3 知识文档（Knowledge Document）上传与管理**

#### **3.9.3.1 `POST /knowledge-bases/{kb_id}/documents/` 上传新知识文档到知识库**

* **摘要**: 上传一个新文档（PDF, DOCX, TXT）到指定知识库。文档内容将在后台异步处理（文本提取、分块、生成嵌入）。嵌入向量的生成依赖于文档上传者配置的硅基流动LLM API密钥。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 要上传文档的知识库ID。
* **请求体**: `multipart/form-data`
 * `file` (File): 要上传的文档文件。
* **响应体**: `schemas.KnowledgeDocumentResponse` (返回文档的初始记录，其`status`为`"processing"`)。
* **常见状态码**: `202 Accepted` (文件已接受并后台处理), `400 Bad Request` (文件为空或格式不支持), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (知识库不存在), `500 Internal Server Error` (文件保存或数据库错误)

#### **3.9.3.2 `GET /knowledge-bases/{kb_id}/documents/` 获取知识库下所有知识文档**

* **摘要**: 获取指定知识库下所有知识文档（已上传文件）的列表。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 要查询文档的知识库ID。
* **查询参数**:
 * `status_filter` (Optional[Literal["uploaded", "processing", "completed", "failed"]]): 过滤条件：按文档处理状态过滤。
* **响应体**: `List[schemas.KnowledgeDocumentResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (知识库不存在)

#### **3.9.3.3 `GET /knowledge-bases/{kb_id}/documents/{document_id}` 获取指定知识文档详情**

* **摘要**: 获取指定知识库下指定知识文档的详细信息。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 所属知识库ID。
 * `document_id` (int): 文档的唯一标识符。
* **响应体**: `schemas.KnowledgeDocumentResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文档未找到或不属于该知识库)

#### **3.9.3.4 `DELETE /knowledge-bases/{kb_id}/documents/{document_id}` 删除指定知识文档**

* **摘要**: 删除指定知识库下的指定知识文档及其所有文本块和服务器上的物理文件。
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 所属知识库ID。
 * `document_id` (int): 要删除的文档ID。
* **响应体**: JSON对象 `{"message": "Knowledge document deleted successfully"}`。
* **常见状态码**: `200 OK` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文档不存在)

#### **3.9.3.5 `GET /knowledge-bases/{kb_id}/documents/{document_id}/content` 获取知识文档的原始文本内容 (DEBUG)**

* **摘要**: 获取指定知识文档（已处理完成）的原始文本内容。**此接口主要用于调试和验证后台处理结果，可能返回大量文本，生产环境请谨慎使用。**
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 所属知识库ID。
 * `document_id` (int): 文档ID。
* **响应体**: JSON对象 `{"content": "..."}`。
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文档不存在), `400 Bad Request` (文档未处理完成或处理失败)

#### **3.9.3.6 `GET /knowledge-bases/{kb_id}/documents/{document_id}/chunks` 获取知识文档文本块列表 (DEBUG)**

* **摘要**: 获取指定知识文档（已处理完成）的所有文本块列表。**此接口主要用于调试和验证文本分块及嵌入，生产环境请谨慎使用。**
* **权限**: 知识库拥有者。
* **路径参数**:
 * `kb_id` (int): 所属知识库ID。
 * `document_id` (int): 文档ID。
* **响应体**: `List[schemas.KnowledgeDocumentChunkResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (文档不存在), `422 Unprocessable Entity` (文档仍在处理中)
