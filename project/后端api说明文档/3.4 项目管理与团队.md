
---

# **鸿庆书云创新协作平台后端API文档 - 3.4 项目管理与团队**

## **目录**

4. **项目管理与团队**
 * 3.4.1 `POST /projects/` 创建新项目
 * 3.4.2 `GET /projects/` 获取所有项目列表
 * 3.4.3 `GET /projects/{project_id}` 获取指定项目详情
 * 3.4.4 `PUT /projects/{project_id}` 更新指定项目
 * 3.4.5 `DELETE /projects/{project_id}` 删除指定项目
 * 3.4.6 `POST /projects/{project_id}/apply` 学生申请加入项目
 * 3.4.7 `GET /projects/{project_id}/applications` 获取项目所有申请列表
 * 3.4.8 `POST /projects/applications/{application_id}/process` 处理项目申请
 * 3.4.9 `GET /projects/{project_id}/members` 获取项目成员列表
 * 3.4.10 `GET /recommend/projects/{student_id}` 为指定学生推荐项目
 * 3.4.11 `GET /projects/{project_id}/match-students` 为指定项目推荐学生

---

## **公共基础模型 `schemas.SkillWithProficiency`**

* **`name`** (str): 技能名称。
* **`level`** (Literal["初窥门径", "登堂入室", "融会贯通", "炉火纯青"]): 技能熟练度等级。

### **公共基础模型 `schemas.ProjectCreate` 和 `schemas.ProjectResponse` (及其相关子模型)**

### `schemas.ProjectCreate` (用于创建请求)

* `title` (str): 项目标题。
* `description` (Optional[str]): 项目描述。
* `required_skills` (Optional[List[schemas.SkillWithProficiency]]): 项目所需的技能列表。
* `required_roles` (Optional[List[str]]): 项目所需角色（例如：“前端开发”、“UI设计师”等）。
* `keywords` (Optional[str]): 项目关键词。
* `project_type` (Optional[str]): 项目类型（例如：“科研”、“社会实践”、“创业”）。
* `expected_deliverables` (Optional[str]): 预期交付物。
* `contact_person_info` (Optional[str]): 联系人信息。
* `learning_outcomes` (Optional[str]): 学习产出。
* `team_size_preference` (Optional[str]): 团队规模偏好（例如：“3-5人”）。
* `project_status` (Optional[Literal["招募中", "进行中", "已完成", "暂停"]]): 项目状态，默认为“招募中”。
* `start_date` (Optional[date]): 项目开始日期。
* `end_date` (Optional[date]): 项目结束日期。
* `estimated_weekly_hours` (Optional[int]): 每周预计投入小时数。
* `location` (Optional[str]): 项目地点。

### `schemas.ProjectUpdate` (用于更新请求)

* 所有字段均为 `Optional`，只更新提供的字段。字段定义与 `ProjectCreate` 相同。

### `schemas.ProjectResponse` (用于响应体)

* `id` (int): 项目ID。
* `creator_id` (int): 项目创建者ID。
* `creator_name` (Optional[str]): 项目创建者姓名（辅助字段）。
* `embedding` (Optional[List[float]]): 项目内容的嵌入向量（系统内部生成）。
* `combined_text` (Optional[str]): 用于AI模型的组合文本（系统内部生成）。
* `views_count` (int): 项目查看次数。
* `applications_count` (int): 项目收到的申请数量。
* `members_count` (int): 项目成员数量。
* `created_at` (datetime): 创建时间。
* `updated_at` (Optional[datetime]): 更新时间。
* 其余字段同 `ProjectCreate`。

---

## **3.4 项目管理与团队**

### **3.4.1 `POST /projects/` 创建新项目**

* **摘要**: 创建一个新项目。项目创建者（当前认证用户）将自动成为项目的创建者。项目内容会生成组合文本和嵌入向量，用于AI匹配和语义搜索。
* **权限**: 已认证用户。
* **请求体**: `schemas.ProjectCreate`
* **响应体**: `schemas.ProjectResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `409 Conflict` (数据冲突)

### **3.4.2 `GET /projects/` 获取所有项目列表**

* **摘要**: 获取平台上所有项目的概要列表。
* **权限**: 已认证用户。
* **响应体**: `List[schemas.ProjectResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

### **3.4.3 `GET /projects/{project_id}` 获取指定项目详情**

* **摘要**: 获取指定ID项目的详细信息。每次访问会增加项目查看数。
* **权限**: 已认证用户。
* **路径参数**:
 * `project_id` (int): 项目的唯一标识符。
* **响应体**: `schemas.ProjectResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `404 Not Found` (项目不存在)

### **3.4.4 `PUT /projects/{project_id}` 更新指定项目**

* **摘要**: 更新指定ID项目的详细信息。只有项目创建者或系统管理员可以修改。当项目状态变为“已完成”时，会触发项目创建者的积分奖励和成就检查。项目内容组合文本和嵌入向量会在更新后自动重新计算。
* **权限**: 项目创建者或系统管理员。
* **路径参数**:
 * `project_id` (int): 项目ID。
* **请求体**: `schemas.ProjectUpdate`
* **响应体**: `schemas.ProjectResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (项目不存在), `409 Conflict` (数据冲突)

### **3.4.5 `DELETE /projects/{project_id}` 删除指定项目**

* **摘要**: 删除指定ID的项目。只有项目创建者或系统管理员可以删除。同时会级联删除所有相关联的项目申请和项目成员记录。
* **权限**: 项目创建者或系统管理员。
* **路径参数**:
 * `project_id` (int): 项目ID。
* **响应体**: 空响应体 (`204 No Content`)。
* **常见状态码**: `204 No Content` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (项目不存在)

### **3.4.6 `POST /projects/{project_id}/apply` 学生申请加入项目**

* **摘要**: 允许学生申请加入指定项目。学生不能重复申请同一项目，也不能申请已是成员的项目。
* **权限**: 已认证用户（学生）。
* **路径参数**:
 * `project_id` (int): 要申请加入的项目ID。
* **请求体**: `schemas.ProjectApplicationCreate`
 * `message` (Optional[str]): 申请留言，例如为什么想加入该项目。
* **响应体**: `schemas.ProjectApplicationResponse`
 * `id` (int): 申请记录ID。
 * `project_id` (int): 申请项目ID。
 * `student_id` (int): 申请学生ID。
 * `status` (Literal["pending", "approved", "rejected"]): 申请状态，新创建为`"pending"`。
 * `message` (Optional[str]): 申请留言。
 * `applied_at` (datetime): 申请提交时间。
 * `processed_at` (Optional[datetime]): 申请处理时间。
 * `processed_by_id` (Optional[int]): 审批者ID。
 * `applicant_name` (str): 申请者姓名（辅助字段）。
 * `applicant_email` (Optional[EmailStr]): 申请者邮箱（辅助字段）。
 * `processor_name` (Optional[str]): 审批者姓名（辅助字段）。
* **常见状态码**: `200 OK` (申请成功), `401 Unauthorized` (未认证), `404 Not Found` (项目不存在), `400 Bad Request` (已是项目成员), `409 Conflict` (已有待处理/被拒绝的申请)

### **3.4.7 `GET /projects/{project_id}/applications` 获取项目所有申请列表**

* **摘要**: 获取指定项目的所有申请列表。可根据申请状态进行筛选。
* **权限**: 项目创建者或系统管理员。
* **路径参数**:
 * `project_id` (int): 要查询申请的项目ID。
* **查询参数**:
 * `status_filter` (Optional[Literal["pending", "approved", "rejected"]]): 筛选申请状态，默认为无筛选（返回所有状态）。
* **响应体**: `List[schemas.ProjectApplicationResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (项目不存在)

### **3.4.8 `POST /projects/applications/{application_id}/process` 处理项目申请**

* **摘要**: 批准或拒绝一个项目的申请。如果申请被批准，对应的学生将成为该项目的成员。
* **权限**: 项目创建者或系统管理员。
* **路径参数**:
 * `application_id` (int): 要处理的申请记录ID。
* **请求体**: `schemas.ProjectApplicationProcess`
 * `status` (Literal["approved", "rejected"]): 审批结果，`"approved"` (批准) 或 `"rejected"` (拒绝)。
 * `process_message` (Optional[str]): 审批时的附言（例如拒绝原因）。
* **响应体**: `schemas.ProjectApplicationResponse` (更新后的申请记录详情)。
* **常见状态码**: `200 OK` (处理成功), `400 Bad Request` (申请状态非待处理), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (申请不存在)

### **3.4.9 `GET /projects/{project_id}/members` 获取项目成员列表**

* **摘要**: 获取指定项目的所有成员列表。
* **权限**: 项目创建者、项目成员或系统管理员。
* **路径参数**:
 * `project_id` (int): 要查询成员的项目ID。
* **响应体**: `List[schemas.ProjectMemberResponse]`
 * `id` (int): 项目成员关联记录ID。
 * `project_id` (int): 所属项目ID。
 * `student_id` (int): 成员学生ID。
 * `role` (Literal["admin", "member"]): 成员角色，默认为`"member"`。
 * `joined_at` (datetime): 加入时间。
 * `member_name` (str): 成员姓名（辅助字段）。
 * `member_email` (Optional[EmailStr]): 成员邮箱（辅助字段）。
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (项目不存在)

### **3.4.10 `GET /recommend/projects/{student_id}` 为指定学生推荐项目**

* **摘要**: 使用AI为指定学生推荐相关的项目。推荐逻辑综合考虑学生技能、兴趣与项目需求的匹配度。
* **权限**: 已认证用户。（在实际业务中，可以限制为学生本人或管理员才能为其推荐）。
* **路径参数**:
 * `student_id` (int): 学生的唯一标识符。
* **查询参数**:
 * `initial_k` (int, default=50): 初步筛选要返回的候选项目数量。
 * `final_k` (int, default=3): 最终重排后返回的推荐项目数量。
* **响应体**: `List[schemas.MatchedProject]`
 * `project_id` (int): 推荐项目的ID。
 * `title` (str): 项目标题。
 * `description` (Optional[str]): 项目描述。
 * `project_type` (Optional[str]): 项目类型。
 * `required_skills` (Optional[List[schemas.SkillWithProficiency]]): 项目所需技能。
 * `similarity_stage1` (float): 第一阶段（粗召回/综合匹配）的相似度得分。
 * `relevance_score` (float): 最终重排后的相关性得分（如果重排成功，则更准确）。
 * `match_rationale` (Optional[str]): AI生成的匹配理由和行动建议。
* **常见状态码**: `200 OK` (成功获取推荐), `404 Not Found` (学生或项目不存在，或无匹配推荐), `500 Internal Server Error` (AI服务失败：例如，用户未配置硅基流动API Key或API调用失败)

### **3.4.11 `GET /projects/{project_id}/match-students` 为指定项目推荐学生**

* **摘要**: 使用AI为指定项目推荐合适的学生，以帮助项目创建者组建团队。推荐逻辑综合考虑项目需求与学生技能、兴趣的匹配度。
* **权限**: 已认证用户。（在实际业务中，可以限制为项目创建者或管理员才能为其推荐）。
* **路径参数**:
 * `project_id` (int): 项目的唯一标识符。
* **查询参数**:
 * `initial_k` (int, default=50): 初步筛选要返回的候选学生数量。
 * `final_k` (int, default=3): 最终重排后返回的推荐学生数量。
* **响应体**: `List[schemas.MatchedStudent]`
 * `student_id` (int): 推荐学生的ID。
 * `name` (Optional[str]): 学生姓名。
 * `major` (Optional[str]): 学生专业。
 * `skills` (Optional[List[schemas.SkillWithProficiency]]): 学生技能。
 * `bio` (Optional[str]): 学生个人简介。
 * `similarity_stage1` (float): 第一阶段（粗召回/综合匹配）的相似度得分。
 * `relevance_score` (float): 最终重排后的相关性得分（如果重排成功，则更准确）。
 * `match_rationale` (Optional[str]): AI生成的匹配理由和行动建议。
* **常见状态码**: `200 OK` (成功获取推荐), `404 Not Found` (项目或学生不存在，或无匹配推荐), `500 Internal Server Error` (AI服务失败：例如，用户未配置硅基流动API Key或API调用失败)

---