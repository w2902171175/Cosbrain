
---

# **鸿庆书云创新协作平台后端API文档 - 3.7 随手记录管理**

## **目录**

7. **随手记录管理**
 * 3.7.1 `POST /daily-records/` 创建新随手记录
 * 3.7.2 `GET /daily-records/` 获取当前用户所有随手记录
 * 3.7.3 `GET /daily-records/{record_id}` 获取指定随手记录详情
 * 3.7.4 `PUT /daily-records/{record_id}` 更新指定随手记录
 * 3.7.5 `DELETE /daily-records/{record_id}` 删除指定随手记录

---

## **公共基础模型 `schemas.DailyRecordBase` 和 `schemas.DailyRecordResponse`**

### `schemas.DailyRecordBase` (用于创建和更新请求)

* `content` (str): 随手记录的主要内容。
* `mood` (Optional[str]): 记录时的心情（例如：“开心”、“沮丧”、“平静”）。
* `tags` (Optional[str]): 逗号分隔的标签（例如：“学习,项目,会议”）。

### `schemas.DailyRecordResponse` (用于响应体)

* `id` (int): 记录的唯一标识符。
* `owner_id` (int): 记录所属用户ID。
* `content` (str): 记录的主要内容。
* `mood` (Optional[str]): 记录时的心情。
* `tags` (Optional[str]): 逗号分隔的标签。
* `combined_text` (Optional[str]): 用于AI模型的组合文本（系统内部生成）。
* `embedding` (Optional[List[float]]): 记录内容的嵌入向量（系统内部生成，用于AI语义搜索）。
* `created_at` (datetime): 记录创建时间。
* `updated_at` (Optional[datetime]): 记录最后更新时间。

---

## **3.7 随手记录管理**

### **3.7.1 `POST /daily-records/` 创建新随手记录**

* **摘要**: 为当前认证用户创建一条新随手记录。后端会根据记录内容自动生成组合文本和嵌入向量。嵌入向量的生成依赖于用户配置的硅基流动LLM API密钥。
* **权限**: 已认证用户。
* **请求体**: `schemas.DailyRecordBase`
* **响应体**: `schemas.DailyRecordResponse`
* **常见状态码**: `200 OK` (创建成功), `401 Unauthorized` (未认证), `500 Internal Server Error` (数据库或AI嵌入生成失败)

### **3.7.2 `GET /daily-records/` 获取当前用户所有随手记录**

* **摘要**: 获取当前认证用户的所有随手记录列表。可选择通过心情 (`mood`) 或标签 (`tag`) 进行过滤。
* **权限**: 已认证用户。
* **查询参数**:
 * `mood` (Optional[str]): 过滤条件：只返回指定心情的记录。
 * `tag` (Optional[str]): 过滤条件：只返回包含指定标签的记录（模糊匹配）。
* **响应体**: `List[schemas.DailyRecordResponse]`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证)

### **3.7.3 `GET /daily-records/{record_id}` 获取指定随手记录详情**

* **摘要**: 获取指定ID的随手记录详情。
* **权限**: 记录所有者。
* **路径参数**:
 * `record_id` (int): 随手记录的唯一标识符。
* **响应体**: `schemas.DailyRecordResponse`
* **常见状态码**: `200 OK` (成功获取), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (记录不存在)

### **3.7.4 `PUT /daily-records/{record_id}` 更新指定随手记录**

* **摘要**: 更新指定ID的随手记录内容。只有记录所有者可以修改。更新后，记录的组合文本和嵌入向量会重新生成。
* **权限**: 记录所有者。
* **路径参数**:
 * `record_id` (int): 要更新的随手记录ID。
* **请求体**: `schemas.DailyRecordBase` (所有字段均为 `Optional`，只更新提供的字段)
* **响应体**: `schemas.DailyRecordResponse`
* **常见状态码**: `200 OK` (更新成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (记录不存在), `500 Internal Server Error` (数据库或AI嵌入生成失败)

### **3.7.5 `DELETE /daily-records/{record_id}` 删除指定随手记录**

* **摘要**: 删除指定ID的随手记录。
* **权限**: 记录所有者。
* **路径参数**:
 * `record_id` (int): 要删除的随手记录ID。
* **响应体**: JSON对象 `{"message": "Daily record deleted successfully"}`。
* **常见状态码**: `200 OK` (删除成功), `401 Unauthorized` (未认证), `403 Forbidden` (无权限), `404 Not Found` (记录不存在)

---

